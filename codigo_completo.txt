
C:\Users\Jhan-PC\power_gruas>(
echo. 
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\firebase_options.dart  
 echo ========================================  
 echo. 
 type "C:\Users\Jhan-PC\power_gruas\lib\firebase_options.dart" 
) 

========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\firebase_options.dart
========================================

// File generated by FlutterFire CLI.
// ignore_for_file: type=lint
import 'package:firebase_core/firebase_core.dart' show FirebaseOptions;
import 'package:flutter/foundation.dart'
    show defaultTargetPlatform, kIsWeb, TargetPlatform;

/// Default [FirebaseOptions] for use with your Firebase apps.
///
/// Example:
/// ```dart
/// import 'firebase_options.dart';
/// // ...
/// await Firebase.initializeApp(
///   options: DefaultFirebaseOptions.currentPlatform,
/// );
/// ```
class DefaultFirebaseOptions {
  static FirebaseOptions get currentPlatform {
    if (kIsWeb) {
      return web;
    }
    switch (defaultTargetPlatform) {
      case TargetPlatform.android:
        return android;
      case TargetPlatform.iOS:
        return ios;
      case TargetPlatform.macOS:
        return macos;
      case TargetPlatform.windows:
        return windows;
      case TargetPlatform.linux:
        throw UnsupportedError(
          'DefaultFirebaseOptions have not been configured for linux - '
          'you can reconfigure this by running the FlutterFire CLI again.',
        );
      default:
        throw UnsupportedError(
          'DefaultFirebaseOptions are not supported for this platform.',
        );
    }
  }

  static const FirebaseOptions web = FirebaseOptions(
    apiKey: 'AIzaSyC3641QfoTo7UxWQwAs8kzNbpzuPPO_z9o',
    appId: '1:661365099508:web:9aae4f5a985933ee4847a1',
    messagingSenderId: '661365099508',
    projectId: 'powergruas-58018',
    authDomain: 'powergruas-58018.firebaseapp.com',
    storageBucket: 'powergruas-58018.firebasestorage.app',
    measurementId: 'G-P48MFELWLJ',
  );

  static const FirebaseOptions android = FirebaseOptions(
    apiKey: 'AIzaSyD2BDAqMB6EX-qzJz4qDeAFg33gXE-bnDg',
    appId: '1:661365099508:android:cf1d7eebb60196c04847a1',
    messagingSenderId: '661365099508',
    projectId: 'powergruas-58018',
    storageBucket: 'powergruas-58018.firebasestorage.app',
  );

  static const FirebaseOptions ios = FirebaseOptions(
    apiKey: 'AIzaSyDLCV9fdmadPkdBuqZCCRLsfJ30bmH0nLo',
    appId: '1:661365099508:ios:2f7b43ea733388444847a1',
    messagingSenderId: '661365099508',
    projectId: 'powergruas-58018',
    storageBucket: 'powergruas-58018.firebasestorage.app',
    iosBundleId: 'com.example.powerGruas',
  );

  static const FirebaseOptions macos = FirebaseOptions(
    apiKey: 'AIzaSyDLCV9fdmadPkdBuqZCCRLsfJ30bmH0nLo',
    appId: '1:661365099508:ios:2f7b43ea733388444847a1',
    messagingSenderId: '661365099508',
    projectId: 'powergruas-58018',
    storageBucket: 'powergruas-58018.firebasestorage.app',
    iosBundleId: 'com.example.powerGruas',
  );

  static const FirebaseOptions windows = FirebaseOptions(
    apiKey: 'AIzaSyC3641QfoTo7UxWQwAs8kzNbpzuPPO_z9o',
    appId: '1:661365099508:web:0b53e49ef1a5781c4847a1',
    messagingSenderId: '661365099508',
    projectId: 'powergruas-58018',
    authDomain: 'powergruas-58018.firebaseapp.com',
    storageBucket: 'powergruas-58018.firebasestorage.app',
    measurementId: 'G-JYB1JFF56N',
  );
}

C:\Users\Jhan-PC\power_gruas>(
echo. 
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\main.dart  
 echo ========================================  
 echo. 
 type "C:\Users\Jhan-PC\power_gruas\lib\main.dart" 
) 

========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\main.dart
========================================

import 'package:firebase_core/firebase_core.dart';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/config/router/app_router.dart';
import 'package:power_gruas/config/theme/app_theme.dart';
import 'firebase_options.dart'; // Archivo generado por flutterfire configure

void main() async {
  WidgetsFlutterBinding.ensureInitialized();

  // Inicializar Firebase
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );

  runApp(
    // Habilitar Riverpod en toda la aplicación
    const ProviderScope(
      child: MyApp(),
    ),
  );
}

class MyApp extends ConsumerWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // Obtener el router configurado por Riverpod
    final router = ref.watch(routerProvider);

    return MaterialApp.router(
      title: 'PowerGrúas',
      theme: AppTheme().getTheme(),
      routerConfig: router,
      debugShowCheckedModeBanner: false,
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\constants\app_constants.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\config\constants\app_constants.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\constants\app_constants.dart
========================================
.
import 'package:flutter/material.dart';

class AppConstants {
  // Paleta de Colores
  static const Color primaryColor = Color(0xFF263687);
  static const Color secondaryColor = Color(0xFF41A6D7);
  static const Color textColor = Color(0xFF000000);
  static const Color backgroundColor = Color(0xFFF5F5F5);

  // Assets
  static const String logoWhite = 'assets/images/logo_blanco_sin_fondo.png';
  static const String logoLoading = 'assets/images/logo_carga.png';
  static const String appIcon = 'assets/images/logo_icono_color.png';

  // --- Configuración de Google Maps (Consideración 3) ---
  // IMPORTANTE: Reemplaza esto con la misma clave de API que usaste en la configuración nativa.
  static const String googleMapsApiKey = 'AIzaSyD07BS5JuuyndnB-xgL6_He_sSWe2DwhI4';


  // Roles (deben coincidir exactamente con Firestore)
  static const String roleCliente = 'cliente';
  static const String roleGruero = 'gruero';
  static const String roleOperador = 'operador';
  static const String roleAdmin = 'admin';
  static const String roleAseguradora = 'aseguradora';

  // Estados de Servicio
  static const String statusPendientePrecio = 'pendientePrecio';
  static const String statusPendientePago = 'pendientePago';
  static const String statusPagoEnVerificacion = 'pagoEnVerificacion';
  static const String statusEnCurso = 'enCurso';
  static const String statusEnSitio = 'enSitio';
  static const String statusFinalizado = 'finalizado';
  static const String statusCancelado = 'cancelado';

  // Estados de Empleado
  static const String employeeStatusDisponible = 'Disponible';
  static const String employeeStatusEnServicio = 'En servicio';

  // Origen de Solicitud
  static const String requestOriginRegular = 'regular';
  static const String requestOriginAseguradora = 'aseguradora';
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\router\app_router.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\config\router\app_router.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\router\app_router.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';
import 'package:power_gruas/presentation/screens/auth/auth_gate.dart';
import 'package:power_gruas/presentation/screens/auth/login_screen.dart';
import 'package:power_gruas/presentation/screens/auth/register_screen.dart';
import 'package:power_gruas/presentation/screens/common/home_screen.dart';
import 'package:power_gruas/presentation/screens/common/profile_screen.dart';
import 'package:power_gruas/presentation/screens/services/my_services_screen.dart';
import 'package:power_gruas/presentation/screens/services/request_service_screen.dart';

final GlobalKey<NavigatorState> _rootNavigatorKey = GlobalKey<NavigatorState>();

final routerProvider = Provider<GoRouter>((ref) {
  final authState = ref.watch(authStateChangesProvider);

  return GoRouter(
    navigatorKey: _rootNavigatorKey,
    initialLocation: '/',
    routes: [
      GoRoute(
        path: '/',
        builder: (context, state) => const AuthGate(),
      ),
      GoRoute(
        path: '/login',
        builder: (context, state) => const LoginScreen(),
      ),
      GoRoute(
        path: '/register',
        builder: (context, state) => const RegisterScreen(),
      ),
      GoRoute(
        path: '/home',
        builder: (context, state) => const HomeScreen(),
      ),
      GoRoute(
        path: '/profile',
        builder: (context, state) => const ProfileScreen(),
      ),
      GoRoute(
        path: '/request_service',
        builder: (context, state) => const RequestServiceScreen(),
      ),
      GoRoute(
        path: '/my_services',
        builder: (context, state) => const MyServicesScreen(),
      ),
    ],
    redirect: (context, state) {
      final bool loggingIn = state.matchedLocation == '/login' || state.matchedLocation == '/register';
      if (authState.isLoading || authState.hasError) {
        return null;
      }
      final bool isAuthenticated = authState.valueOrNull != null;
      if (isAuthenticated) {
        if (loggingIn) {
          return '/home';
        }
      } else {
        if (!loggingIn && state.matchedLocation != '/') {
          return '/login';
        }
      }
      return null;
    },
  );
});
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\theme\app_theme.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\config\theme\app_theme.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\config\theme\app_theme.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:power_gruas/config/constants/app_constants.dart';

class AppTheme {
  ThemeData getTheme() => ThemeData(
        useMaterial3: true,
        colorScheme: ColorScheme.fromSeed(
          seedColor: AppConstants.primaryColor,
          primary: AppConstants.primaryColor,
          secondary: AppConstants.secondaryColor,
          // CORREGIDO: 'background' está obsoleto en Material 3, usamos 'surface'.
          surface: AppConstants.backgroundColor,
        ),
        scaffoldBackgroundColor: AppConstants.backgroundColor,

        // Configuración de Fuentes
        fontFamily: 'Arimo',
        textTheme: const TextTheme(
          titleLarge: TextStyle(
              fontSize: 22.0,
              fontWeight: FontWeight.bold,
              color: AppConstants.textColor),
          titleMedium: TextStyle(
              fontSize: 18.0,
              fontWeight: FontWeight.w600,
              color: AppConstants.textColor),
          bodyMedium:
              TextStyle(fontSize: 16.0, color: AppConstants.textColor),
          bodySmall:
              TextStyle(fontSize: 14.0, color: AppConstants.textColor),
        ),

        // Configuración de AppBar
        appBarTheme: const AppBarTheme(
          centerTitle: true,
          backgroundColor: AppConstants.primaryColor,
          foregroundColor: Colors.white,
          elevation: 0,
        ),

        // Configuración de Input (TextFields)
        inputDecorationTheme: InputDecorationTheme(
          border: OutlineInputBorder(
            borderRadius: BorderRadius.circular(12.0),
          ),
          filled: true,
          fillColor: Colors.white,
          contentPadding:
              const EdgeInsets.symmetric(horizontal: 20.0, vertical: 15.0),
        ),

        // Configuración de Botones
        elevatedButtonTheme: ElevatedButtonThemeData(
          style: ElevatedButton.styleFrom(
            backgroundColor: AppConstants.secondaryColor,
            foregroundColor: Colors.white,
            shape: RoundedRectangleBorder(
              borderRadius: BorderRadius.circular(12.0),
            ),
            padding: const EdgeInsets.symmetric(vertical: 15.0),
            textStyle: const TextStyle(
              fontSize: 18.0,
              fontWeight: FontWeight.bold,
              fontFamily: 'Arimo',
            ),
          ),
        ),

        // Configuración de Tarjetas (Cards)
        // CORREGIDO: Se usa CardThemeData.
        cardTheme: CardThemeData(
          elevation: 4.0,
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(15.0),
          ),
          margin: const EdgeInsets.symmetric(horizontal: 10.0, vertical: 6.0),
        ),

         // Configuración de Diálogos
         // CORREGIDO: Se usa DialogThemeData.
        dialogTheme: DialogThemeData(
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(20.0),
          ),
        ),
      );
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\auth_remote_datasource.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\datasources\auth_remote_datasource.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\auth_remote_datasource.dart
========================================
.
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

// Proveedor para la instancia de FirebaseAuth
final firebaseAuthProvider = Provider<FirebaseAuth>((ref) {
  return FirebaseAuth.instance;
});

// Proveedor para el DataSource
final authRemoteDataSourceProvider = Provider<AuthRemoteDataSource>((ref) {
  return AuthRemoteDataSource(ref.watch(firebaseAuthProvider));
});

class AuthRemoteDataSource {
  final FirebaseAuth _auth;

  AuthRemoteDataSource(this._auth);

  Stream<User?> get authStateChanges => _auth.authStateChanges();

  User? get currentUser => _auth.currentUser;

  Future<UserCredential> signInWithEmailAndPassword(String email, String password) async {
    // FirebaseAuth lanza excepciones (ej. usuario no encontrado, contraseña incorrecta)
    // que atraparemos en el AuthController para dar feedback al usuario.
    return await _auth.signInWithEmailAndPassword(email: email, password: password);
  }

  Future<UserCredential> createUserWithEmailAndPassword(String email, String password) async {
     // Lanza excepciones (ej. correo ya en uso)
    return await _auth.createUserWithEmailAndPassword(email: email, password: password);
  }

  Future<void> signOut() async {
    await _auth.signOut();
  }

  // Método añadido para restablecimiento de contraseña (Consideración 4)
  Future<void> sendPasswordResetEmail(String email) async {
    // Lanza excepción si el correo no existe.
    await _auth.sendPasswordResetEmail(email: email);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\firestore_datasource.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\datasources\firestore_datasource.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\firestore_datasource.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';

// Proveedor para la instancia de Firestore
final firestoreProvider = Provider<FirebaseFirestore>((ref) {
  return FirebaseFirestore.instance;
});

// Proveedor para el DataSource
final firestoreDataSourceProvider = Provider<FirestoreDataSource>((ref) {
  return FirestoreDataSource(ref.watch(firestoreProvider));
});

class FirestoreDataSource {
  final FirebaseFirestore _db;

  FirestoreDataSource(this._db);

  // --- Métodos Genéricos ---

  Future<DocumentSnapshot> getDocument(String collection, String docId) async {
    return await _db.collection(collection).doc(docId).get();
  }

  Future<QuerySnapshot> getCollection(String collection, {Query Function(Query)? queryBuilder}) async {
    Query query = _db.collection(collection);
    if (queryBuilder != null) {
      query = queryBuilder(query);
    }
    return await query.get();
  }

  Stream<DocumentSnapshot> streamDocument(String collection, String docId) {
    return _db.collection(collection).doc(docId).snapshots();
  }

  Stream<QuerySnapshot> streamCollection(String collection, {Query Function(Query)? queryBuilder}) {
    Query query = _db.collection(collection);
    if (queryBuilder != null) {
      query = queryBuilder(query);
    }
    return query.snapshots();
  }

  Future<void> setDocument(String collection, String docId, Map<String, dynamic> data, {bool merge = false}) async {
    await _db.collection(collection).doc(docId).set(data, SetOptions(merge: merge));
  }

  Future<DocumentReference> addDocument(String collection, Map<String, dynamic> data) async {
    return await _db.collection(collection).add(data);
  }

  Future<void> updateDocument(String collection, String docId, Map<String, dynamic> data) async {
    await _db.collection(collection).doc(docId).update(data);
  }

  Future<void> deleteDocument(String collection, String docId) async {
    await _db.collection(collection).doc(docId).delete();
  }

  // --- Métodos para Subcolecciones (Ej. Vehículos) ---

  Future<QuerySnapshot> getSubCollection(String parentCollection, String parentDocId, String subCollection) async {
    return await _db.collection(parentCollection).doc(parentDocId).collection(subCollection).get();
  }

  Stream<QuerySnapshot> streamSubCollection(String parentCollection, String parentDocId, String subCollection) {
    return _db.collection(parentCollection).doc(parentDocId).collection(subCollection).snapshots();
  }

  Future<DocumentReference> addSubCollectionDocument(String parentCollection, String parentDocId, String subCollection, Map<String, dynamic> data) async {
    return await _db.collection(parentCollection).doc(parentDocId).collection(subCollection).add(data);
  }

   Future<void> updateSubCollectionDocument(String parentCollection, String parentDocId, String subCollection, String docId, Map<String, dynamic> data) async {
    await _db.collection(parentCollection).doc(parentDocId).collection(subCollection).doc(docId).update(data);
  }

  Future<void> deleteSubCollectionDocument(String parentCollection, String parentDocId, String subCollection, String docId) async {
    await _db.collection(parentCollection).doc(parentDocId).collection(subCollection).doc(docId).delete();
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\maps_datasource.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\datasources\maps_datasource.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\maps_datasource.dart
========================================
.
import 'dart:convert';
import 'package:flutter/foundation.dart'; // Importado para kDebugMode y debugPrint
import 'package:geocoding/geocoding.dart';
import 'package:geolocator/geolocator.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:http/http.dart' as http;
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/data/models/directions_model.dart';

final mapsDataSourceProvider = Provider<MapsDataSource>((ref) {
  return MapsDataSource();
});


class MapsDataSource {
  // URL base para la API de Directions de Google
  static const String _baseUrl = 'https://maps.googleapis.com/maps/api/directions/json';

  // --- Geolocator (Ubicación del Dispositivo) ---

  Future<bool> handleLocationPermission() async {
    bool serviceEnabled;
    LocationPermission permission;

    serviceEnabled = await Geolocator.isLocationServiceEnabled();
    if (!serviceEnabled) {
      return false;
    }

    permission = await Geolocator.checkPermission();
    if (permission == LocationPermission.denied) {
      permission = await Geolocator.requestPermission();
      if (permission == LocationPermission.denied) {
        return false;
      }
    }

    if (permission == LocationPermission.deniedForever) {
      return false;
    }

    return true;
  }

  Future<Position> getCurrentPosition() async {
    final hasPermission = await handleLocationPermission();
    if (!hasPermission) {
      throw Exception("Location permissions are denied");
    }
    return await Geolocator.getCurrentPosition(
        desiredAccuracy: LocationAccuracy.high);
  }

  Stream<Position> getPositionStream() {
    return Geolocator.getPositionStream();
  }


  // --- Geocoding (Coordenadas a Dirección) ---

  Future<String> getAddressFromLatLng(LatLng position) async {
    try {
      // Usamos el paquete geocoding para la conversión inversa.
      List<Placemark> placemarks = await placemarkFromCoordinates(
          position.latitude, position.longitude);
      Placemark place = placemarks[0];
      return "${place.street}, ${place.locality}, ${place.administrativeArea}";
    } catch (e) {
      return "Address not found";
    }
  }

  // --- Directions API (Rutas, Distancia y Duración) ---

  Future<Directions> getDirections(LatLng origin, LatLng destination) async {
    if (AppConstants.googleMapsApiKey == 'AIzaSyD07BS5JuuyndnB-xgL6_He_sSWe2DwhI4') {
      throw Exception('Google Maps API Key not configured in app_constants.dart');
    }

    // Construimos la URL para la petición HTTP GET
    final String url = '$_baseUrl?'
        'origin=${origin.latitude},${origin.longitude}&'
        'destination=${destination.latitude},${destination.longitude}&'
        'key=${AppConstants.googleMapsApiKey}&'
        'language=es'; // Solicitamos resultados en español

    try {
      final response = await http.get(Uri.parse(url));

      if (response.statusCode == 200) {
        final Map<String, dynamic> data = json.decode(response.body);

        if (data['status'] == 'OK') {
          // Usamos el modelo Directions para parsear la respuesta compleja
          final directions = Directions.fromMap(data);
          return directions;
        } else {
          throw Exception('Directions API error: ${data['status']} - ${data['error_message'] ?? ''}');
        }

      } else {
        throw Exception('Failed to load directions. Status code: ${response.statusCode}');
      }
    } catch (e) {
      // CORREGIDO: Usamos debugPrint en lugar de print, solo en modo desarrollo.
      if (kDebugMode) {
        debugPrint('Error fetching directions: $e');
      }
      rethrow;
    }
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\storage_datasource.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\datasources\storage_datasource.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\datasources\storage_datasource.dart
========================================
.
import 'dart:io';
import 'package:firebase_storage/firebase_storage.dart';
import 'package:flutter/foundation.dart'; // Importado para kDebugMode y debugPrint
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:uuid/uuid.dart';

// Proveedor para la instancia de FirebaseStorage
final firebaseStorageProvider = Provider<FirebaseStorage>((ref) {
  return FirebaseStorage.instance;
});

// Proveedor para el DataSource
final storageDataSourceProvider = Provider<StorageDataSource>((ref) {
  return StorageDataSource(ref.watch(firebaseStorageProvider));
});

class StorageDataSource {
  final FirebaseStorage _storage;
  // CORREGIDO: Añadido const al constructor de Uuid.
  final Uuid _uuid = const Uuid();

  StorageDataSource(this._storage);

  /// Sube un archivo a Firebase Storage y retorna la URL de descarga.
  Future<String> uploadFile(File file, String path) async {
    try {
      // Genera un nombre de archivo único
      String fileName = '${_uuid.v4()}.${file.path.split('.').last}';
      Reference ref = _storage.ref().child(path).child(fileName);

      UploadTask uploadTask = ref.putFile(file);
      TaskSnapshot snapshot = await uploadTask;
      String downloadUrl = await snapshot.ref.getDownloadURL();

      return downloadUrl;
    } catch (e) {
      // Manejo de errores de Storage
      throw Exception('Error uploading file: $e');
    }
  }

  Future<void> deleteFile(String downloadUrl) async {
    try {
      Reference ref = _storage.refFromURL(downloadUrl);
      await ref.delete();
    } catch (e) {
      // CORREGIDO: Usamos debugPrint en lugar de print, solo en modo desarrollo.
      if (kDebugMode) {
        debugPrint('Error deleting file: $e');
      }
    }
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'bank_model.freezed.dart';
part 'bank_model.g.dart';

@freezed
class BankModel with _$BankModel {
  const factory BankModel({
    String? id,
    required String name,
    required bool isActive,
    required String country,
  }) = _BankModel;

  factory BankModel.fromJson(Map<String, dynamic> json) =>
      _$BankModelFromJson(json);

  factory BankModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) throw Exception("Bank document data is null");
     data['id'] = doc.id;
    return BankModel.fromJson(data);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'bank_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

BankModel _$BankModelFromJson(Map<String, dynamic> json) {
  return _BankModel.fromJson(json);
}

/// @nodoc
mixin _$BankModel {
  String? get id => throw _privateConstructorUsedError;
  String get name => throw _privateConstructorUsedError;
  bool get isActive => throw _privateConstructorUsedError;
  String get country => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $BankModelCopyWith<BankModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $BankModelCopyWith<$Res> {
  factory $BankModelCopyWith(BankModel value, $Res Function(BankModel) then) =
      _$BankModelCopyWithImpl<$Res, BankModel>;
  @useResult
  $Res call({String? id, String name, bool isActive, String country});
}

/// @nodoc
class _$BankModelCopyWithImpl<$Res, $Val extends BankModel>
    implements $BankModelCopyWith<$Res> {
  _$BankModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? name = null,
    Object? isActive = null,
    Object? country = null,
  }) {
    return _then(_value.copyWith(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      name: null == name
          ? _value.name
          : name // ignore: cast_nullable_to_non_nullable
              as String,
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      country: null == country
          ? _value.country
          : country // ignore: cast_nullable_to_non_nullable
              as String,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$BankModelImplCopyWith<$Res>
    implements $BankModelCopyWith<$Res> {
  factory _$$BankModelImplCopyWith(
          _$BankModelImpl value, $Res Function(_$BankModelImpl) then) =
      __$$BankModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call({String? id, String name, bool isActive, String country});
}

/// @nodoc
class __$$BankModelImplCopyWithImpl<$Res>
    extends _$BankModelCopyWithImpl<$Res, _$BankModelImpl>
    implements _$$BankModelImplCopyWith<$Res> {
  __$$BankModelImplCopyWithImpl(
      _$BankModelImpl _value, $Res Function(_$BankModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? name = null,
    Object? isActive = null,
    Object? country = null,
  }) {
    return _then(_$BankModelImpl(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      name: null == name
          ? _value.name
          : name // ignore: cast_nullable_to_non_nullable
              as String,
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      country: null == country
          ? _value.country
          : country // ignore: cast_nullable_to_non_nullable
              as String,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$BankModelImpl implements _BankModel {
  const _$BankModelImpl(
      {this.id,
      required this.name,
      required this.isActive,
      required this.country});

  factory _$BankModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$BankModelImplFromJson(json);

  @override
  final String? id;
  @override
  final String name;
  @override
  final bool isActive;
  @override
  final String country;

  @override
  String toString() {
    return 'BankModel(id: $id, name: $name, isActive: $isActive, country: $country)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$BankModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.name, name) || other.name == name) &&
            (identical(other.isActive, isActive) ||
                other.isActive == isActive) &&
            (identical(other.country, country) || other.country == country));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(runtimeType, id, name, isActive, country);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$BankModelImplCopyWith<_$BankModelImpl> get copyWith =>
      __$$BankModelImplCopyWithImpl<_$BankModelImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$BankModelImplToJson(
      this,
    );
  }
}

abstract class _BankModel implements BankModel {
  const factory _BankModel(
      {final String? id,
      required final String name,
      required final bool isActive,
      required final String country}) = _$BankModelImpl;

  factory _BankModel.fromJson(Map<String, dynamic> json) =
      _$BankModelImpl.fromJson;

  @override
  String? get id;
  @override
  String get name;
  @override
  bool get isActive;
  @override
  String get country;
  @override
  @JsonKey(ignore: true)
  _$$BankModelImplCopyWith<_$BankModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\bank_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'bank_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$BankModelImpl _$$BankModelImplFromJson(Map<String, dynamic> json) =>
    _$BankModelImpl(
      id: json['id'] as String?,
      name: json['name'] as String,
      isActive: json['isActive'] as bool,
      country: json['country'] as String,
    );

Map<String, dynamic> _$$BankModelImplToJson(_$BankModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'name': instance.name,
      'isActive': instance.isActive,
      'country': instance.country,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.dart
========================================
.
import 'package:freezed_annotation/freezed_annotation.dart';

part 'company_info_model.freezed.dart';
part 'company_info_model.g.dart';

// Documento: contact
@freezed
class ContactInfo with _$ContactInfo {
  const factory ContactInfo({
    // CORREGIDO: Usar lowerCamelCase (Dart) y JsonKey para mapear al snake_case (Firestore).
    @JsonKey(name: 'whatsapp_url') String? whatsappUrl,
    @JsonKey(name: 'facebook_url') String? facebookUrl,
    @JsonKey(name: 'instagram_url') String? instagramUrl,
    @JsonKey(name: 'website_url') String? websiteUrl,
  }) = _ContactInfo;

  factory ContactInfo.fromJson(Map<String, dynamic> json) =>
      _$ContactInfoFromJson(json);
}

// Documento: about_us
@freezed
class AboutUsInfo with _$AboutUsInfo {
  const factory AboutUsInfo({
    String? mission,
    String? vision,
    String? objective,
    String? history,
  }) = _AboutUsInfo;

  factory AboutUsInfo.fromJson(Map<String, dynamic> json) =>
      _$AboutUsInfoFromJson(json);
}

// Documento: company_info
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'company_info_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

ContactInfo _$ContactInfoFromJson(Map<String, dynamic> json) {
  return _ContactInfo.fromJson(json);
}

/// @nodoc
mixin _$ContactInfo {
// CORREGIDO: Usar lowerCamelCase (Dart) y JsonKey para mapear al snake_case (Firestore).
  @JsonKey(name: 'whatsapp_url')
  String? get whatsappUrl => throw _privateConstructorUsedError;
  @JsonKey(name: 'facebook_url')
  String? get facebookUrl => throw _privateConstructorUsedError;
  @JsonKey(name: 'instagram_url')
  String? get instagramUrl => throw _privateConstructorUsedError;
  @JsonKey(name: 'website_url')
  String? get websiteUrl => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $ContactInfoCopyWith<ContactInfo> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $ContactInfoCopyWith<$Res> {
  factory $ContactInfoCopyWith(
          ContactInfo value, $Res Function(ContactInfo) then) =
      _$ContactInfoCopyWithImpl<$Res, ContactInfo>;
  @useResult
  $Res call(
      {@JsonKey(name: 'whatsapp_url') String? whatsappUrl,
      @JsonKey(name: 'facebook_url') String? facebookUrl,
      @JsonKey(name: 'instagram_url') String? instagramUrl,
      @JsonKey(name: 'website_url') String? websiteUrl});
}

/// @nodoc
class _$ContactInfoCopyWithImpl<$Res, $Val extends ContactInfo>
    implements $ContactInfoCopyWith<$Res> {
  _$ContactInfoCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? whatsappUrl = freezed,
    Object? facebookUrl = freezed,
    Object? instagramUrl = freezed,
    Object? websiteUrl = freezed,
  }) {
    return _then(_value.copyWith(
      whatsappUrl: freezed == whatsappUrl
          ? _value.whatsappUrl
          : whatsappUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      facebookUrl: freezed == facebookUrl
          ? _value.facebookUrl
          : facebookUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      instagramUrl: freezed == instagramUrl
          ? _value.instagramUrl
          : instagramUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      websiteUrl: freezed == websiteUrl
          ? _value.websiteUrl
          : websiteUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$ContactInfoImplCopyWith<$Res>
    implements $ContactInfoCopyWith<$Res> {
  factory _$$ContactInfoImplCopyWith(
          _$ContactInfoImpl value, $Res Function(_$ContactInfoImpl) then) =
      __$$ContactInfoImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {@JsonKey(name: 'whatsapp_url') String? whatsappUrl,
      @JsonKey(name: 'facebook_url') String? facebookUrl,
      @JsonKey(name: 'instagram_url') String? instagramUrl,
      @JsonKey(name: 'website_url') String? websiteUrl});
}

/// @nodoc
class __$$ContactInfoImplCopyWithImpl<$Res>
    extends _$ContactInfoCopyWithImpl<$Res, _$ContactInfoImpl>
    implements _$$ContactInfoImplCopyWith<$Res> {
  __$$ContactInfoImplCopyWithImpl(
      _$ContactInfoImpl _value, $Res Function(_$ContactInfoImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? whatsappUrl = freezed,
    Object? facebookUrl = freezed,
    Object? instagramUrl = freezed,
    Object? websiteUrl = freezed,
  }) {
    return _then(_$ContactInfoImpl(
      whatsappUrl: freezed == whatsappUrl
          ? _value.whatsappUrl
          : whatsappUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      facebookUrl: freezed == facebookUrl
          ? _value.facebookUrl
          : facebookUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      instagramUrl: freezed == instagramUrl
          ? _value.instagramUrl
          : instagramUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      websiteUrl: freezed == websiteUrl
          ? _value.websiteUrl
          : websiteUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$ContactInfoImpl implements _ContactInfo {
  const _$ContactInfoImpl(
      {@JsonKey(name: 'whatsapp_url') this.whatsappUrl,
      @JsonKey(name: 'facebook_url') this.facebookUrl,
      @JsonKey(name: 'instagram_url') this.instagramUrl,
      @JsonKey(name: 'website_url') this.websiteUrl});

  factory _$ContactInfoImpl.fromJson(Map<String, dynamic> json) =>
      _$$ContactInfoImplFromJson(json);

// CORREGIDO: Usar lowerCamelCase (Dart) y JsonKey para mapear al snake_case (Firestore).
  @override
  @JsonKey(name: 'whatsapp_url')
  final String? whatsappUrl;
  @override
  @JsonKey(name: 'facebook_url')
  final String? facebookUrl;
  @override
  @JsonKey(name: 'instagram_url')
  final String? instagramUrl;
  @override
  @JsonKey(name: 'website_url')
  final String? websiteUrl;

  @override
  String toString() {
    return 'ContactInfo(whatsappUrl: $whatsappUrl, facebookUrl: $facebookUrl, instagramUrl: $instagramUrl, websiteUrl: $websiteUrl)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$ContactInfoImpl &&
            (identical(other.whatsappUrl, whatsappUrl) ||
                other.whatsappUrl == whatsappUrl) &&
            (identical(other.facebookUrl, facebookUrl) ||
                other.facebookUrl == facebookUrl) &&
            (identical(other.instagramUrl, instagramUrl) ||
                other.instagramUrl == instagramUrl) &&
            (identical(other.websiteUrl, websiteUrl) ||
                other.websiteUrl == websiteUrl));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(
      runtimeType, whatsappUrl, facebookUrl, instagramUrl, websiteUrl);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$ContactInfoImplCopyWith<_$ContactInfoImpl> get copyWith =>
      __$$ContactInfoImplCopyWithImpl<_$ContactInfoImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$ContactInfoImplToJson(
      this,
    );
  }
}

abstract class _ContactInfo implements ContactInfo {
  const factory _ContactInfo(
          {@JsonKey(name: 'whatsapp_url') final String? whatsappUrl,
          @JsonKey(name: 'facebook_url') final String? facebookUrl,
          @JsonKey(name: 'instagram_url') final String? instagramUrl,
          @JsonKey(name: 'website_url') final String? websiteUrl}) =
      _$ContactInfoImpl;

  factory _ContactInfo.fromJson(Map<String, dynamic> json) =
      _$ContactInfoImpl.fromJson;

  @override // CORREGIDO: Usar lowerCamelCase (Dart) y JsonKey para mapear al snake_case (Firestore).
  @JsonKey(name: 'whatsapp_url')
  String? get whatsappUrl;
  @override
  @JsonKey(name: 'facebook_url')
  String? get facebookUrl;
  @override
  @JsonKey(name: 'instagram_url')
  String? get instagramUrl;
  @override
  @JsonKey(name: 'website_url')
  String? get websiteUrl;
  @override
  @JsonKey(ignore: true)
  _$$ContactInfoImplCopyWith<_$ContactInfoImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

AboutUsInfo _$AboutUsInfoFromJson(Map<String, dynamic> json) {
  return _AboutUsInfo.fromJson(json);
}

/// @nodoc
mixin _$AboutUsInfo {
  String? get mission => throw _privateConstructorUsedError;
  String? get vision => throw _privateConstructorUsedError;
  String? get objective => throw _privateConstructorUsedError;
  String? get history => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $AboutUsInfoCopyWith<AboutUsInfo> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $AboutUsInfoCopyWith<$Res> {
  factory $AboutUsInfoCopyWith(
          AboutUsInfo value, $Res Function(AboutUsInfo) then) =
      _$AboutUsInfoCopyWithImpl<$Res, AboutUsInfo>;
  @useResult
  $Res call(
      {String? mission, String? vision, String? objective, String? history});
}

/// @nodoc
class _$AboutUsInfoCopyWithImpl<$Res, $Val extends AboutUsInfo>
    implements $AboutUsInfoCopyWith<$Res> {
  _$AboutUsInfoCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? mission = freezed,
    Object? vision = freezed,
    Object? objective = freezed,
    Object? history = freezed,
  }) {
    return _then(_value.copyWith(
      mission: freezed == mission
          ? _value.mission
          : mission // ignore: cast_nullable_to_non_nullable
              as String?,
      vision: freezed == vision
          ? _value.vision
          : vision // ignore: cast_nullable_to_non_nullable
              as String?,
      objective: freezed == objective
          ? _value.objective
          : objective // ignore: cast_nullable_to_non_nullable
              as String?,
      history: freezed == history
          ? _value.history
          : history // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$AboutUsInfoImplCopyWith<$Res>
    implements $AboutUsInfoCopyWith<$Res> {
  factory _$$AboutUsInfoImplCopyWith(
          _$AboutUsInfoImpl value, $Res Function(_$AboutUsInfoImpl) then) =
      __$$AboutUsInfoImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String? mission, String? vision, String? objective, String? history});
}

/// @nodoc
class __$$AboutUsInfoImplCopyWithImpl<$Res>
    extends _$AboutUsInfoCopyWithImpl<$Res, _$AboutUsInfoImpl>
    implements _$$AboutUsInfoImplCopyWith<$Res> {
  __$$AboutUsInfoImplCopyWithImpl(
      _$AboutUsInfoImpl _value, $Res Function(_$AboutUsInfoImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? mission = freezed,
    Object? vision = freezed,
    Object? objective = freezed,
    Object? history = freezed,
  }) {
    return _then(_$AboutUsInfoImpl(
      mission: freezed == mission
          ? _value.mission
          : mission // ignore: cast_nullable_to_non_nullable
              as String?,
      vision: freezed == vision
          ? _value.vision
          : vision // ignore: cast_nullable_to_non_nullable
              as String?,
      objective: freezed == objective
          ? _value.objective
          : objective // ignore: cast_nullable_to_non_nullable
              as String?,
      history: freezed == history
          ? _value.history
          : history // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$AboutUsInfoImpl implements _AboutUsInfo {
  const _$AboutUsInfoImpl(
      {this.mission, this.vision, this.objective, this.history});

  factory _$AboutUsInfoImpl.fromJson(Map<String, dynamic> json) =>
      _$$AboutUsInfoImplFromJson(json);

  @override
  final String? mission;
  @override
  final String? vision;
  @override
  final String? objective;
  @override
  final String? history;

  @override
  String toString() {
    return 'AboutUsInfo(mission: $mission, vision: $vision, objective: $objective, history: $history)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$AboutUsInfoImpl &&
            (identical(other.mission, mission) || other.mission == mission) &&
            (identical(other.vision, vision) || other.vision == vision) &&
            (identical(other.objective, objective) ||
                other.objective == objective) &&
            (identical(other.history, history) || other.history == history));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode =>
      Object.hash(runtimeType, mission, vision, objective, history);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$AboutUsInfoImplCopyWith<_$AboutUsInfoImpl> get copyWith =>
      __$$AboutUsInfoImplCopyWithImpl<_$AboutUsInfoImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$AboutUsInfoImplToJson(
      this,
    );
  }
}

abstract class _AboutUsInfo implements AboutUsInfo {
  const factory _AboutUsInfo(
      {final String? mission,
      final String? vision,
      final String? objective,
      final String? history}) = _$AboutUsInfoImpl;

  factory _AboutUsInfo.fromJson(Map<String, dynamic> json) =
      _$AboutUsInfoImpl.fromJson;

  @override
  String? get mission;
  @override
  String? get vision;
  @override
  String? get objective;
  @override
  String? get history;
  @override
  @JsonKey(ignore: true)
  _$$AboutUsInfoImplCopyWith<_$AboutUsInfoImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\company_info_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'company_info_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$ContactInfoImpl _$$ContactInfoImplFromJson(Map<String, dynamic> json) =>
    _$ContactInfoImpl(
      whatsappUrl: json['whatsapp_url'] as String?,
      facebookUrl: json['facebook_url'] as String?,
      instagramUrl: json['instagram_url'] as String?,
      websiteUrl: json['website_url'] as String?,
    );

Map<String, dynamic> _$$ContactInfoImplToJson(_$ContactInfoImpl instance) =>
    <String, dynamic>{
      'whatsapp_url': instance.whatsappUrl,
      'facebook_url': instance.facebookUrl,
      'instagram_url': instance.instagramUrl,
      'website_url': instance.websiteUrl,
    };

_$AboutUsInfoImpl _$$AboutUsInfoImplFromJson(Map<String, dynamic> json) =>
    _$AboutUsInfoImpl(
      mission: json['mission'] as String?,
      vision: json['vision'] as String?,
      objective: json['objective'] as String?,
      history: json['history'] as String?,
    );

Map<String, dynamic> _$$AboutUsInfoImplToJson(_$AboutUsInfoImpl instance) =>
    <String, dynamic>{
      'mission': instance.mission,
      'vision': instance.vision,
      'objective': instance.objective,
      'history': instance.history,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.dart
========================================
.
import 'package:flutter_polyline_points/flutter_polyline_points.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'directions_model.freezed.dart';

@freezed
class Directions with _$Directions {
  const factory Directions({
    required LatLngBounds bounds,
    required List<LatLng> polylinePoints,
    required String totalDistance,
    required String totalDuration,
  }) = _Directions;

  /// Parsea la respuesta JSON de la API de Directions de Google.
  factory Directions.fromMap(Map<String, dynamic> map) {
    // Verifica si la respuesta contiene una ruta válida
    if ((map['routes'] as List).isEmpty) {
      throw Exception('No se encontró una ruta.');
    }

    // Obtiene la información de la primera ruta
    final data = Map<String, dynamic>.from(map['routes'][0]);

    // Bounds (Límites del mapa)
    final northeast = data['bounds']['northeast'];
    final southwest = data['bounds']['southwest'];
    final bounds = LatLngBounds(
      northeast: LatLng(northeast['lat'], northeast['lng']),
      southwest: LatLng(southwest['lat'], southwest['lng']),
    );

    // Distancia y Duración
    String distance = '';
    String duration = '';
    if ((data['legs'] as List).isNotEmpty) {
      final leg = data['legs'][0];
      distance = leg['distance']['text'];
      duration = leg['duration']['text'];
    }

    // Polyline Points (Decodificación usando flutter_polyline_points)
    final polyline = data['overview_polyline']['points'];

    // CORREGIDO: Uso correcto de la librería. Se debe instanciar PolylinePoints().
    // En la versión 2.0.0+ de la librería, el constructor no requiere API Key y el método es de instancia.
    final polylinePoints = PolylinePoints()
        .decodePolyline(polyline)
        .map((point) => LatLng(point.latitude, point.longitude))
        .toList();

    return Directions(
      bounds: bounds,
      polylinePoints: polylinePoints,
      totalDistance: distance,
      totalDuration: duration,
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\directions_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'directions_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

/// @nodoc
mixin _$Directions {
  LatLngBounds get bounds => throw _privateConstructorUsedError;
  List<LatLng> get polylinePoints => throw _privateConstructorUsedError;
  String get totalDistance => throw _privateConstructorUsedError;
  String get totalDuration => throw _privateConstructorUsedError;

  @JsonKey(ignore: true)
  $DirectionsCopyWith<Directions> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $DirectionsCopyWith<$Res> {
  factory $DirectionsCopyWith(
          Directions value, $Res Function(Directions) then) =
      _$DirectionsCopyWithImpl<$Res, Directions>;
  @useResult
  $Res call(
      {LatLngBounds bounds,
      List<LatLng> polylinePoints,
      String totalDistance,
      String totalDuration});
}

/// @nodoc
class _$DirectionsCopyWithImpl<$Res, $Val extends Directions>
    implements $DirectionsCopyWith<$Res> {
  _$DirectionsCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? bounds = null,
    Object? polylinePoints = null,
    Object? totalDistance = null,
    Object? totalDuration = null,
  }) {
    return _then(_value.copyWith(
      bounds: null == bounds
          ? _value.bounds
          : bounds // ignore: cast_nullable_to_non_nullable
              as LatLngBounds,
      polylinePoints: null == polylinePoints
          ? _value.polylinePoints
          : polylinePoints // ignore: cast_nullable_to_non_nullable
              as List<LatLng>,
      totalDistance: null == totalDistance
          ? _value.totalDistance
          : totalDistance // ignore: cast_nullable_to_non_nullable
              as String,
      totalDuration: null == totalDuration
          ? _value.totalDuration
          : totalDuration // ignore: cast_nullable_to_non_nullable
              as String,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$DirectionsImplCopyWith<$Res>
    implements $DirectionsCopyWith<$Res> {
  factory _$$DirectionsImplCopyWith(
          _$DirectionsImpl value, $Res Function(_$DirectionsImpl) then) =
      __$$DirectionsImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {LatLngBounds bounds,
      List<LatLng> polylinePoints,
      String totalDistance,
      String totalDuration});
}

/// @nodoc
class __$$DirectionsImplCopyWithImpl<$Res>
    extends _$DirectionsCopyWithImpl<$Res, _$DirectionsImpl>
    implements _$$DirectionsImplCopyWith<$Res> {
  __$$DirectionsImplCopyWithImpl(
      _$DirectionsImpl _value, $Res Function(_$DirectionsImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? bounds = null,
    Object? polylinePoints = null,
    Object? totalDistance = null,
    Object? totalDuration = null,
  }) {
    return _then(_$DirectionsImpl(
      bounds: null == bounds
          ? _value.bounds
          : bounds // ignore: cast_nullable_to_non_nullable
              as LatLngBounds,
      polylinePoints: null == polylinePoints
          ? _value._polylinePoints
          : polylinePoints // ignore: cast_nullable_to_non_nullable
              as List<LatLng>,
      totalDistance: null == totalDistance
          ? _value.totalDistance
          : totalDistance // ignore: cast_nullable_to_non_nullable
              as String,
      totalDuration: null == totalDuration
          ? _value.totalDuration
          : totalDuration // ignore: cast_nullable_to_non_nullable
              as String,
    ));
  }
}

/// @nodoc

class _$DirectionsImpl implements _Directions {
  const _$DirectionsImpl(
      {required this.bounds,
      required final List<LatLng> polylinePoints,
      required this.totalDistance,
      required this.totalDuration})
      : _polylinePoints = polylinePoints;

  @override
  final LatLngBounds bounds;
  final List<LatLng> _polylinePoints;
  @override
  List<LatLng> get polylinePoints {
    if (_polylinePoints is EqualUnmodifiableListView) return _polylinePoints;
    // ignore: implicit_dynamic_type
    return EqualUnmodifiableListView(_polylinePoints);
  }

  @override
  final String totalDistance;
  @override
  final String totalDuration;

  @override
  String toString() {
    return 'Directions(bounds: $bounds, polylinePoints: $polylinePoints, totalDistance: $totalDistance, totalDuration: $totalDuration)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$DirectionsImpl &&
            (identical(other.bounds, bounds) || other.bounds == bounds) &&
            const DeepCollectionEquality()
                .equals(other._polylinePoints, _polylinePoints) &&
            (identical(other.totalDistance, totalDistance) ||
                other.totalDistance == totalDistance) &&
            (identical(other.totalDuration, totalDuration) ||
                other.totalDuration == totalDuration));
  }

  @override
  int get hashCode => Object.hash(
      runtimeType,
      bounds,
      const DeepCollectionEquality().hash(_polylinePoints),
      totalDistance,
      totalDuration);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$DirectionsImplCopyWith<_$DirectionsImpl> get copyWith =>
      __$$DirectionsImplCopyWithImpl<_$DirectionsImpl>(this, _$identity);
}

abstract class _Directions implements Directions {
  const factory _Directions(
      {required final LatLngBounds bounds,
      required final List<LatLng> polylinePoints,
      required final String totalDistance,
      required final String totalDuration}) = _$DirectionsImpl;

  @override
  LatLngBounds get bounds;
  @override
  List<LatLng> get polylinePoints;
  @override
  String get totalDistance;
  @override
  String get totalDuration;
  @override
  @JsonKey(ignore: true)
  _$$DirectionsImplCopyWith<_$DirectionsImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\firestore_converters.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\firestore_converters.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\firestore_converters.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

// --- Convertidor para Timestamp (Soluciona el error SEVERE) ---

// Convertidor necesario porque json_serializable no sabe manejar Timestamp por defecto.
class TimestampConverter implements JsonConverter<Timestamp, Timestamp> {
  const TimestampConverter();

  @override
  Timestamp fromJson(Timestamp timestamp) {
    // Cuando Firestore lee el dato (usando el SDK), ya es un Timestamp.
    return timestamp;
  }

  @override
  Timestamp toJson(Timestamp timestamp) {
    // Cuando enviamos el dato a Firestore (usando el SDK), lo enviamos como Timestamp.
    return timestamp;
  }
}

// --- Convertidor para GeoPoint ---

class GeoPointConverter implements JsonConverter<GeoPoint, GeoPoint> {
  const GeoPointConverter();

  @override
  GeoPoint fromJson(GeoPoint geoPoint) {
    return geoPoint;
  }

  @override
  GeoPoint toJson(GeoPoint geoPoint) => geoPoint;
}

// --- Convertidor para GeoPoint Opcional (Nullable) ---

class NullableGeoPointConverter implements JsonConverter<GeoPoint?, GeoPoint?> {
  const NullableGeoPointConverter();

  @override
  GeoPoint? fromJson(GeoPoint? geoPoint) {
    return geoPoint;
  }

  @override
  GeoPoint? toJson(GeoPoint? geoPoint) => geoPoint;
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'fleet_model.freezed.dart';
part 'fleet_model.g.dart';

@freezed
class FleetModel with _$FleetModel {
  const factory FleetModel({
    String? id,
    required String placa,
    required String modelo,
    required String tipo, // Grúas de plataforma, etc.
    required String status, // disponible, en servicio, en mantenimiento
    String? currentGrueroId,
    String? photoUrl,
  }) = _FleetModel;

  factory FleetModel.fromJson(Map<String, dynamic> json) =>
      _$FleetModelFromJson(json);

    factory FleetModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) throw Exception("Fleet document data is null");
     data['id'] = doc.id;
    return FleetModel.fromJson(data);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'fleet_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

FleetModel _$FleetModelFromJson(Map<String, dynamic> json) {
  return _FleetModel.fromJson(json);
}

/// @nodoc
mixin _$FleetModel {
  String? get id => throw _privateConstructorUsedError;
  String get placa => throw _privateConstructorUsedError;
  String get modelo => throw _privateConstructorUsedError;
  String get tipo =>
      throw _privateConstructorUsedError; // Grúas de plataforma, etc.
  String get status =>
      throw _privateConstructorUsedError; // disponible, en servicio, en mantenimiento
  String? get currentGrueroId => throw _privateConstructorUsedError;
  String? get photoUrl => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $FleetModelCopyWith<FleetModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $FleetModelCopyWith<$Res> {
  factory $FleetModelCopyWith(
          FleetModel value, $Res Function(FleetModel) then) =
      _$FleetModelCopyWithImpl<$Res, FleetModel>;
  @useResult
  $Res call(
      {String? id,
      String placa,
      String modelo,
      String tipo,
      String status,
      String? currentGrueroId,
      String? photoUrl});
}

/// @nodoc
class _$FleetModelCopyWithImpl<$Res, $Val extends FleetModel>
    implements $FleetModelCopyWith<$Res> {
  _$FleetModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? placa = null,
    Object? modelo = null,
    Object? tipo = null,
    Object? status = null,
    Object? currentGrueroId = freezed,
    Object? photoUrl = freezed,
  }) {
    return _then(_value.copyWith(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      placa: null == placa
          ? _value.placa
          : placa // ignore: cast_nullable_to_non_nullable
              as String,
      modelo: null == modelo
          ? _value.modelo
          : modelo // ignore: cast_nullable_to_non_nullable
              as String,
      tipo: null == tipo
          ? _value.tipo
          : tipo // ignore: cast_nullable_to_non_nullable
              as String,
      status: null == status
          ? _value.status
          : status // ignore: cast_nullable_to_non_nullable
              as String,
      currentGrueroId: freezed == currentGrueroId
          ? _value.currentGrueroId
          : currentGrueroId // ignore: cast_nullable_to_non_nullable
              as String?,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$FleetModelImplCopyWith<$Res>
    implements $FleetModelCopyWith<$Res> {
  factory _$$FleetModelImplCopyWith(
          _$FleetModelImpl value, $Res Function(_$FleetModelImpl) then) =
      __$$FleetModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String? id,
      String placa,
      String modelo,
      String tipo,
      String status,
      String? currentGrueroId,
      String? photoUrl});
}

/// @nodoc
class __$$FleetModelImplCopyWithImpl<$Res>
    extends _$FleetModelCopyWithImpl<$Res, _$FleetModelImpl>
    implements _$$FleetModelImplCopyWith<$Res> {
  __$$FleetModelImplCopyWithImpl(
      _$FleetModelImpl _value, $Res Function(_$FleetModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? placa = null,
    Object? modelo = null,
    Object? tipo = null,
    Object? status = null,
    Object? currentGrueroId = freezed,
    Object? photoUrl = freezed,
  }) {
    return _then(_$FleetModelImpl(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      placa: null == placa
          ? _value.placa
          : placa // ignore: cast_nullable_to_non_nullable
              as String,
      modelo: null == modelo
          ? _value.modelo
          : modelo // ignore: cast_nullable_to_non_nullable
              as String,
      tipo: null == tipo
          ? _value.tipo
          : tipo // ignore: cast_nullable_to_non_nullable
              as String,
      status: null == status
          ? _value.status
          : status // ignore: cast_nullable_to_non_nullable
              as String,
      currentGrueroId: freezed == currentGrueroId
          ? _value.currentGrueroId
          : currentGrueroId // ignore: cast_nullable_to_non_nullable
              as String?,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$FleetModelImpl implements _FleetModel {
  const _$FleetModelImpl(
      {this.id,
      required this.placa,
      required this.modelo,
      required this.tipo,
      required this.status,
      this.currentGrueroId,
      this.photoUrl});

  factory _$FleetModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$FleetModelImplFromJson(json);

  @override
  final String? id;
  @override
  final String placa;
  @override
  final String modelo;
  @override
  final String tipo;
// Grúas de plataforma, etc.
  @override
  final String status;
// disponible, en servicio, en mantenimiento
  @override
  final String? currentGrueroId;
  @override
  final String? photoUrl;

  @override
  String toString() {
    return 'FleetModel(id: $id, placa: $placa, modelo: $modelo, tipo: $tipo, status: $status, currentGrueroId: $currentGrueroId, photoUrl: $photoUrl)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$FleetModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.placa, placa) || other.placa == placa) &&
            (identical(other.modelo, modelo) || other.modelo == modelo) &&
            (identical(other.tipo, tipo) || other.tipo == tipo) &&
            (identical(other.status, status) || other.status == status) &&
            (identical(other.currentGrueroId, currentGrueroId) ||
                other.currentGrueroId == currentGrueroId) &&
            (identical(other.photoUrl, photoUrl) ||
                other.photoUrl == photoUrl));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(
      runtimeType, id, placa, modelo, tipo, status, currentGrueroId, photoUrl);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$FleetModelImplCopyWith<_$FleetModelImpl> get copyWith =>
      __$$FleetModelImplCopyWithImpl<_$FleetModelImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$FleetModelImplToJson(
      this,
    );
  }
}

abstract class _FleetModel implements FleetModel {
  const factory _FleetModel(
      {final String? id,
      required final String placa,
      required final String modelo,
      required final String tipo,
      required final String status,
      final String? currentGrueroId,
      final String? photoUrl}) = _$FleetModelImpl;

  factory _FleetModel.fromJson(Map<String, dynamic> json) =
      _$FleetModelImpl.fromJson;

  @override
  String? get id;
  @override
  String get placa;
  @override
  String get modelo;
  @override
  String get tipo;
  @override // Grúas de plataforma, etc.
  String get status;
  @override // disponible, en servicio, en mantenimiento
  String? get currentGrueroId;
  @override
  String? get photoUrl;
  @override
  @JsonKey(ignore: true)
  _$$FleetModelImplCopyWith<_$FleetModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\fleet_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'fleet_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$FleetModelImpl _$$FleetModelImplFromJson(Map<String, dynamic> json) =>
    _$FleetModelImpl(
      id: json['id'] as String?,
      placa: json['placa'] as String,
      modelo: json['modelo'] as String,
      tipo: json['tipo'] as String,
      status: json['status'] as String,
      currentGrueroId: json['currentGrueroId'] as String?,
      photoUrl: json['photoUrl'] as String?,
    );

Map<String, dynamic> _$$FleetModelImplToJson(_$FleetModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'placa': instance.placa,
      'modelo': instance.modelo,
      'tipo': instance.tipo,
      'status': instance.status,
      'currentGrueroId': instance.currentGrueroId,
      'photoUrl': instance.photoUrl,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'service_model.freezed.dart';
part 'service_model.g.dart';

@freezed
class ServiceModel with _$ServiceModel {
  const factory ServiceModel({
    String? id,
    required String name,
    required String description,
    required bool isActive,
    required String serviceKey, // grua, gasolina, bateria
    required bool requiresDestination,
    required List<String> applicableVehicleTypes,
  }) = _ServiceModel;

  factory ServiceModel.fromJson(Map<String, dynamic> json) =>
      _$ServiceModelFromJson(json);

  factory ServiceModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) throw Exception("Service document data is null");
     data['id'] = doc.id;
    return ServiceModel.fromJson(data);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'service_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

ServiceModel _$ServiceModelFromJson(Map<String, dynamic> json) {
  return _ServiceModel.fromJson(json);
}

/// @nodoc
mixin _$ServiceModel {
  String? get id => throw _privateConstructorUsedError;
  String get name => throw _privateConstructorUsedError;
  String get description => throw _privateConstructorUsedError;
  bool get isActive => throw _privateConstructorUsedError;
  String get serviceKey =>
      throw _privateConstructorUsedError; // grua, gasolina, bateria
  bool get requiresDestination => throw _privateConstructorUsedError;
  List<String> get applicableVehicleTypes => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $ServiceModelCopyWith<ServiceModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $ServiceModelCopyWith<$Res> {
  factory $ServiceModelCopyWith(
          ServiceModel value, $Res Function(ServiceModel) then) =
      _$ServiceModelCopyWithImpl<$Res, ServiceModel>;
  @useResult
  $Res call(
      {String? id,
      String name,
      String description,
      bool isActive,
      String serviceKey,
      bool requiresDestination,
      List<String> applicableVehicleTypes});
}

/// @nodoc
class _$ServiceModelCopyWithImpl<$Res, $Val extends ServiceModel>
    implements $ServiceModelCopyWith<$Res> {
  _$ServiceModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? name = null,
    Object? description = null,
    Object? isActive = null,
    Object? serviceKey = null,
    Object? requiresDestination = null,
    Object? applicableVehicleTypes = null,
  }) {
    return _then(_value.copyWith(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      name: null == name
          ? _value.name
          : name // ignore: cast_nullable_to_non_nullable
              as String,
      description: null == description
          ? _value.description
          : description // ignore: cast_nullable_to_non_nullable
              as String,
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      serviceKey: null == serviceKey
          ? _value.serviceKey
          : serviceKey // ignore: cast_nullable_to_non_nullable
              as String,
      requiresDestination: null == requiresDestination
          ? _value.requiresDestination
          : requiresDestination // ignore: cast_nullable_to_non_nullable
              as bool,
      applicableVehicleTypes: null == applicableVehicleTypes
          ? _value.applicableVehicleTypes
          : applicableVehicleTypes // ignore: cast_nullable_to_non_nullable
              as List<String>,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$ServiceModelImplCopyWith<$Res>
    implements $ServiceModelCopyWith<$Res> {
  factory _$$ServiceModelImplCopyWith(
          _$ServiceModelImpl value, $Res Function(_$ServiceModelImpl) then) =
      __$$ServiceModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String? id,
      String name,
      String description,
      bool isActive,
      String serviceKey,
      bool requiresDestination,
      List<String> applicableVehicleTypes});
}

/// @nodoc
class __$$ServiceModelImplCopyWithImpl<$Res>
    extends _$ServiceModelCopyWithImpl<$Res, _$ServiceModelImpl>
    implements _$$ServiceModelImplCopyWith<$Res> {
  __$$ServiceModelImplCopyWithImpl(
      _$ServiceModelImpl _value, $Res Function(_$ServiceModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? name = null,
    Object? description = null,
    Object? isActive = null,
    Object? serviceKey = null,
    Object? requiresDestination = null,
    Object? applicableVehicleTypes = null,
  }) {
    return _then(_$ServiceModelImpl(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      name: null == name
          ? _value.name
          : name // ignore: cast_nullable_to_non_nullable
              as String,
      description: null == description
          ? _value.description
          : description // ignore: cast_nullable_to_non_nullable
              as String,
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      serviceKey: null == serviceKey
          ? _value.serviceKey
          : serviceKey // ignore: cast_nullable_to_non_nullable
              as String,
      requiresDestination: null == requiresDestination
          ? _value.requiresDestination
          : requiresDestination // ignore: cast_nullable_to_non_nullable
              as bool,
      applicableVehicleTypes: null == applicableVehicleTypes
          ? _value._applicableVehicleTypes
          : applicableVehicleTypes // ignore: cast_nullable_to_non_nullable
              as List<String>,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$ServiceModelImpl implements _ServiceModel {
  const _$ServiceModelImpl(
      {this.id,
      required this.name,
      required this.description,
      required this.isActive,
      required this.serviceKey,
      required this.requiresDestination,
      required final List<String> applicableVehicleTypes})
      : _applicableVehicleTypes = applicableVehicleTypes;

  factory _$ServiceModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$ServiceModelImplFromJson(json);

  @override
  final String? id;
  @override
  final String name;
  @override
  final String description;
  @override
  final bool isActive;
  @override
  final String serviceKey;
// grua, gasolina, bateria
  @override
  final bool requiresDestination;
  final List<String> _applicableVehicleTypes;
  @override
  List<String> get applicableVehicleTypes {
    if (_applicableVehicleTypes is EqualUnmodifiableListView)
      return _applicableVehicleTypes;
    // ignore: implicit_dynamic_type
    return EqualUnmodifiableListView(_applicableVehicleTypes);
  }

  @override
  String toString() {
    return 'ServiceModel(id: $id, name: $name, description: $description, isActive: $isActive, serviceKey: $serviceKey, requiresDestination: $requiresDestination, applicableVehicleTypes: $applicableVehicleTypes)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$ServiceModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.name, name) || other.name == name) &&
            (identical(other.description, description) ||
                other.description == description) &&
            (identical(other.isActive, isActive) ||
                other.isActive == isActive) &&
            (identical(other.serviceKey, serviceKey) ||
                other.serviceKey == serviceKey) &&
            (identical(other.requiresDestination, requiresDestination) ||
                other.requiresDestination == requiresDestination) &&
            const DeepCollectionEquality().equals(
                other._applicableVehicleTypes, _applicableVehicleTypes));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(
      runtimeType,
      id,
      name,
      description,
      isActive,
      serviceKey,
      requiresDestination,
      const DeepCollectionEquality().hash(_applicableVehicleTypes));

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$ServiceModelImplCopyWith<_$ServiceModelImpl> get copyWith =>
      __$$ServiceModelImplCopyWithImpl<_$ServiceModelImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$ServiceModelImplToJson(
      this,
    );
  }
}

abstract class _ServiceModel implements ServiceModel {
  const factory _ServiceModel(
      {final String? id,
      required final String name,
      required final String description,
      required final bool isActive,
      required final String serviceKey,
      required final bool requiresDestination,
      required final List<String> applicableVehicleTypes}) = _$ServiceModelImpl;

  factory _ServiceModel.fromJson(Map<String, dynamic> json) =
      _$ServiceModelImpl.fromJson;

  @override
  String? get id;
  @override
  String get name;
  @override
  String get description;
  @override
  bool get isActive;
  @override
  String get serviceKey;
  @override // grua, gasolina, bateria
  bool get requiresDestination;
  @override
  List<String> get applicableVehicleTypes;
  @override
  @JsonKey(ignore: true)
  _$$ServiceModelImplCopyWith<_$ServiceModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'service_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$ServiceModelImpl _$$ServiceModelImplFromJson(Map<String, dynamic> json) =>
    _$ServiceModelImpl(
      id: json['id'] as String?,
      name: json['name'] as String,
      description: json['description'] as String,
      isActive: json['isActive'] as bool,
      serviceKey: json['serviceKey'] as String,
      requiresDestination: json['requiresDestination'] as bool,
      applicableVehicleTypes: (json['applicableVehicleTypes'] as List<dynamic>)
          .map((e) => e as String)
          .toList(),
    );

Map<String, dynamic> _$$ServiceModelImplToJson(_$ServiceModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'name': instance.name,
      'description': instance.description,
      'isActive': instance.isActive,
      'serviceKey': instance.serviceKey,
      'requiresDestination': instance.requiresDestination,
      'applicableVehicleTypes': instance.applicableVehicleTypes,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.dart
========================================
.
import 'package:freezed_annotation/freezed_annotation.dart';

part 'service_rate_model.freezed.dart';
part 'service_rate_model.g.dart';

// Documento: base_rates
@freezed
class BaseRates with _$BaseRates {
  const factory BaseRates({
    // CORREGIDO: Usar lowerCamelCase y JsonKey.
    @JsonKey(name: 'servicio_grua_km') double? servicioGruaKm,
    @JsonKey(name: 'auxilio_gasolina') double? auxilioGasolina,
    @JsonKey(name: 'auxilio_bateria') double? auxilioBateria,
    // Añadir más campos según sea necesario
  }) = _BaseRates;

  factory BaseRates.fromJson(Map<String, dynamic> json) =>
      _$BaseRatesFromJson(json);
}

// Documento: surcharges
@freezed
class Surcharges with _$Surcharges {
  const factory Surcharges({
    // CORREGIDO: Usar lowerCamelCase y JsonKey.
    @JsonKey(name: 'vehiculo_blindado') double? vehiculoBlindado,
    double? sotano,
    @JsonKey(name: 'carga_pesada') double? cargaPesada,
  }) = _Surcharges;

  factory Surcharges.fromJson(Map<String, dynamic> json) =>
      _$SurchargesFromJson(json);
}

// Documento: night_schedule
@freezed
class NightSchedule with _$NightSchedule {
  const factory NightSchedule({
    required bool isActive,
    // CORREGIDO: Usar lowerCamelCase y JsonKey.
    @JsonKey(name: 'start_hour') required int startHour,
    @JsonKey(name: 'end_hour') required int endHour,
    @JsonKey(name: 'rate_multiplier') required double rateMultiplier,
  }) = _NightSchedule;

  factory NightSchedule.fromJson(Map<String, dynamic> json) =>
      _$NightScheduleFromJson(json);
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'service_rate_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

BaseRates _$BaseRatesFromJson(Map<String, dynamic> json) {
  return _BaseRates.fromJson(json);
}

/// @nodoc
mixin _$BaseRates {
// CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'servicio_grua_km')
  double? get servicioGruaKm => throw _privateConstructorUsedError;
  @JsonKey(name: 'auxilio_gasolina')
  double? get auxilioGasolina => throw _privateConstructorUsedError;
  @JsonKey(name: 'auxilio_bateria')
  double? get auxilioBateria => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $BaseRatesCopyWith<BaseRates> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $BaseRatesCopyWith<$Res> {
  factory $BaseRatesCopyWith(BaseRates value, $Res Function(BaseRates) then) =
      _$BaseRatesCopyWithImpl<$Res, BaseRates>;
  @useResult
  $Res call(
      {@JsonKey(name: 'servicio_grua_km') double? servicioGruaKm,
      @JsonKey(name: 'auxilio_gasolina') double? auxilioGasolina,
      @JsonKey(name: 'auxilio_bateria') double? auxilioBateria});
}

/// @nodoc
class _$BaseRatesCopyWithImpl<$Res, $Val extends BaseRates>
    implements $BaseRatesCopyWith<$Res> {
  _$BaseRatesCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? servicioGruaKm = freezed,
    Object? auxilioGasolina = freezed,
    Object? auxilioBateria = freezed,
  }) {
    return _then(_value.copyWith(
      servicioGruaKm: freezed == servicioGruaKm
          ? _value.servicioGruaKm
          : servicioGruaKm // ignore: cast_nullable_to_non_nullable
              as double?,
      auxilioGasolina: freezed == auxilioGasolina
          ? _value.auxilioGasolina
          : auxilioGasolina // ignore: cast_nullable_to_non_nullable
              as double?,
      auxilioBateria: freezed == auxilioBateria
          ? _value.auxilioBateria
          : auxilioBateria // ignore: cast_nullable_to_non_nullable
              as double?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$BaseRatesImplCopyWith<$Res>
    implements $BaseRatesCopyWith<$Res> {
  factory _$$BaseRatesImplCopyWith(
          _$BaseRatesImpl value, $Res Function(_$BaseRatesImpl) then) =
      __$$BaseRatesImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {@JsonKey(name: 'servicio_grua_km') double? servicioGruaKm,
      @JsonKey(name: 'auxilio_gasolina') double? auxilioGasolina,
      @JsonKey(name: 'auxilio_bateria') double? auxilioBateria});
}

/// @nodoc
class __$$BaseRatesImplCopyWithImpl<$Res>
    extends _$BaseRatesCopyWithImpl<$Res, _$BaseRatesImpl>
    implements _$$BaseRatesImplCopyWith<$Res> {
  __$$BaseRatesImplCopyWithImpl(
      _$BaseRatesImpl _value, $Res Function(_$BaseRatesImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? servicioGruaKm = freezed,
    Object? auxilioGasolina = freezed,
    Object? auxilioBateria = freezed,
  }) {
    return _then(_$BaseRatesImpl(
      servicioGruaKm: freezed == servicioGruaKm
          ? _value.servicioGruaKm
          : servicioGruaKm // ignore: cast_nullable_to_non_nullable
              as double?,
      auxilioGasolina: freezed == auxilioGasolina
          ? _value.auxilioGasolina
          : auxilioGasolina // ignore: cast_nullable_to_non_nullable
              as double?,
      auxilioBateria: freezed == auxilioBateria
          ? _value.auxilioBateria
          : auxilioBateria // ignore: cast_nullable_to_non_nullable
              as double?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$BaseRatesImpl implements _BaseRates {
  const _$BaseRatesImpl(
      {@JsonKey(name: 'servicio_grua_km') this.servicioGruaKm,
      @JsonKey(name: 'auxilio_gasolina') this.auxilioGasolina,
      @JsonKey(name: 'auxilio_bateria') this.auxilioBateria});

  factory _$BaseRatesImpl.fromJson(Map<String, dynamic> json) =>
      _$$BaseRatesImplFromJson(json);

// CORREGIDO: Usar lowerCamelCase y JsonKey.
  @override
  @JsonKey(name: 'servicio_grua_km')
  final double? servicioGruaKm;
  @override
  @JsonKey(name: 'auxilio_gasolina')
  final double? auxilioGasolina;
  @override
  @JsonKey(name: 'auxilio_bateria')
  final double? auxilioBateria;

  @override
  String toString() {
    return 'BaseRates(servicioGruaKm: $servicioGruaKm, auxilioGasolina: $auxilioGasolina, auxilioBateria: $auxilioBateria)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$BaseRatesImpl &&
            (identical(other.servicioGruaKm, servicioGruaKm) ||
                other.servicioGruaKm == servicioGruaKm) &&
            (identical(other.auxilioGasolina, auxilioGasolina) ||
                other.auxilioGasolina == auxilioGasolina) &&
            (identical(other.auxilioBateria, auxilioBateria) ||
                other.auxilioBateria == auxilioBateria));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode =>
      Object.hash(runtimeType, servicioGruaKm, auxilioGasolina, auxilioBateria);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$BaseRatesImplCopyWith<_$BaseRatesImpl> get copyWith =>
      __$$BaseRatesImplCopyWithImpl<_$BaseRatesImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$BaseRatesImplToJson(
      this,
    );
  }
}

abstract class _BaseRates implements BaseRates {
  const factory _BaseRates(
          {@JsonKey(name: 'servicio_grua_km') final double? servicioGruaKm,
          @JsonKey(name: 'auxilio_gasolina') final double? auxilioGasolina,
          @JsonKey(name: 'auxilio_bateria') final double? auxilioBateria}) =
      _$BaseRatesImpl;

  factory _BaseRates.fromJson(Map<String, dynamic> json) =
      _$BaseRatesImpl.fromJson;

  @override // CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'servicio_grua_km')
  double? get servicioGruaKm;
  @override
  @JsonKey(name: 'auxilio_gasolina')
  double? get auxilioGasolina;
  @override
  @JsonKey(name: 'auxilio_bateria')
  double? get auxilioBateria;
  @override
  @JsonKey(ignore: true)
  _$$BaseRatesImplCopyWith<_$BaseRatesImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

Surcharges _$SurchargesFromJson(Map<String, dynamic> json) {
  return _Surcharges.fromJson(json);
}

/// @nodoc
mixin _$Surcharges {
// CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'vehiculo_blindado')
  double? get vehiculoBlindado => throw _privateConstructorUsedError;
  double? get sotano => throw _privateConstructorUsedError;
  @JsonKey(name: 'carga_pesada')
  double? get cargaPesada => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $SurchargesCopyWith<Surcharges> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $SurchargesCopyWith<$Res> {
  factory $SurchargesCopyWith(
          Surcharges value, $Res Function(Surcharges) then) =
      _$SurchargesCopyWithImpl<$Res, Surcharges>;
  @useResult
  $Res call(
      {@JsonKey(name: 'vehiculo_blindado') double? vehiculoBlindado,
      double? sotano,
      @JsonKey(name: 'carga_pesada') double? cargaPesada});
}

/// @nodoc
class _$SurchargesCopyWithImpl<$Res, $Val extends Surcharges>
    implements $SurchargesCopyWith<$Res> {
  _$SurchargesCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? vehiculoBlindado = freezed,
    Object? sotano = freezed,
    Object? cargaPesada = freezed,
  }) {
    return _then(_value.copyWith(
      vehiculoBlindado: freezed == vehiculoBlindado
          ? _value.vehiculoBlindado
          : vehiculoBlindado // ignore: cast_nullable_to_non_nullable
              as double?,
      sotano: freezed == sotano
          ? _value.sotano
          : sotano // ignore: cast_nullable_to_non_nullable
              as double?,
      cargaPesada: freezed == cargaPesada
          ? _value.cargaPesada
          : cargaPesada // ignore: cast_nullable_to_non_nullable
              as double?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$SurchargesImplCopyWith<$Res>
    implements $SurchargesCopyWith<$Res> {
  factory _$$SurchargesImplCopyWith(
          _$SurchargesImpl value, $Res Function(_$SurchargesImpl) then) =
      __$$SurchargesImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {@JsonKey(name: 'vehiculo_blindado') double? vehiculoBlindado,
      double? sotano,
      @JsonKey(name: 'carga_pesada') double? cargaPesada});
}

/// @nodoc
class __$$SurchargesImplCopyWithImpl<$Res>
    extends _$SurchargesCopyWithImpl<$Res, _$SurchargesImpl>
    implements _$$SurchargesImplCopyWith<$Res> {
  __$$SurchargesImplCopyWithImpl(
      _$SurchargesImpl _value, $Res Function(_$SurchargesImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? vehiculoBlindado = freezed,
    Object? sotano = freezed,
    Object? cargaPesada = freezed,
  }) {
    return _then(_$SurchargesImpl(
      vehiculoBlindado: freezed == vehiculoBlindado
          ? _value.vehiculoBlindado
          : vehiculoBlindado // ignore: cast_nullable_to_non_nullable
              as double?,
      sotano: freezed == sotano
          ? _value.sotano
          : sotano // ignore: cast_nullable_to_non_nullable
              as double?,
      cargaPesada: freezed == cargaPesada
          ? _value.cargaPesada
          : cargaPesada // ignore: cast_nullable_to_non_nullable
              as double?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$SurchargesImpl implements _Surcharges {
  const _$SurchargesImpl(
      {@JsonKey(name: 'vehiculo_blindado') this.vehiculoBlindado,
      this.sotano,
      @JsonKey(name: 'carga_pesada') this.cargaPesada});

  factory _$SurchargesImpl.fromJson(Map<String, dynamic> json) =>
      _$$SurchargesImplFromJson(json);

// CORREGIDO: Usar lowerCamelCase y JsonKey.
  @override
  @JsonKey(name: 'vehiculo_blindado')
  final double? vehiculoBlindado;
  @override
  final double? sotano;
  @override
  @JsonKey(name: 'carga_pesada')
  final double? cargaPesada;

  @override
  String toString() {
    return 'Surcharges(vehiculoBlindado: $vehiculoBlindado, sotano: $sotano, cargaPesada: $cargaPesada)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$SurchargesImpl &&
            (identical(other.vehiculoBlindado, vehiculoBlindado) ||
                other.vehiculoBlindado == vehiculoBlindado) &&
            (identical(other.sotano, sotano) || other.sotano == sotano) &&
            (identical(other.cargaPesada, cargaPesada) ||
                other.cargaPesada == cargaPesada));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode =>
      Object.hash(runtimeType, vehiculoBlindado, sotano, cargaPesada);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$SurchargesImplCopyWith<_$SurchargesImpl> get copyWith =>
      __$$SurchargesImplCopyWithImpl<_$SurchargesImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$SurchargesImplToJson(
      this,
    );
  }
}

abstract class _Surcharges implements Surcharges {
  const factory _Surcharges(
          {@JsonKey(name: 'vehiculo_blindado') final double? vehiculoBlindado,
          final double? sotano,
          @JsonKey(name: 'carga_pesada') final double? cargaPesada}) =
      _$SurchargesImpl;

  factory _Surcharges.fromJson(Map<String, dynamic> json) =
      _$SurchargesImpl.fromJson;

  @override // CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'vehiculo_blindado')
  double? get vehiculoBlindado;
  @override
  double? get sotano;
  @override
  @JsonKey(name: 'carga_pesada')
  double? get cargaPesada;
  @override
  @JsonKey(ignore: true)
  _$$SurchargesImplCopyWith<_$SurchargesImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

NightSchedule _$NightScheduleFromJson(Map<String, dynamic> json) {
  return _NightSchedule.fromJson(json);
}

/// @nodoc
mixin _$NightSchedule {
  bool get isActive =>
      throw _privateConstructorUsedError; // CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'start_hour')
  int get startHour => throw _privateConstructorUsedError;
  @JsonKey(name: 'end_hour')
  int get endHour => throw _privateConstructorUsedError;
  @JsonKey(name: 'rate_multiplier')
  double get rateMultiplier => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $NightScheduleCopyWith<NightSchedule> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $NightScheduleCopyWith<$Res> {
  factory $NightScheduleCopyWith(
          NightSchedule value, $Res Function(NightSchedule) then) =
      _$NightScheduleCopyWithImpl<$Res, NightSchedule>;
  @useResult
  $Res call(
      {bool isActive,
      @JsonKey(name: 'start_hour') int startHour,
      @JsonKey(name: 'end_hour') int endHour,
      @JsonKey(name: 'rate_multiplier') double rateMultiplier});
}

/// @nodoc
class _$NightScheduleCopyWithImpl<$Res, $Val extends NightSchedule>
    implements $NightScheduleCopyWith<$Res> {
  _$NightScheduleCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? isActive = null,
    Object? startHour = null,
    Object? endHour = null,
    Object? rateMultiplier = null,
  }) {
    return _then(_value.copyWith(
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      startHour: null == startHour
          ? _value.startHour
          : startHour // ignore: cast_nullable_to_non_nullable
              as int,
      endHour: null == endHour
          ? _value.endHour
          : endHour // ignore: cast_nullable_to_non_nullable
              as int,
      rateMultiplier: null == rateMultiplier
          ? _value.rateMultiplier
          : rateMultiplier // ignore: cast_nullable_to_non_nullable
              as double,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$NightScheduleImplCopyWith<$Res>
    implements $NightScheduleCopyWith<$Res> {
  factory _$$NightScheduleImplCopyWith(
          _$NightScheduleImpl value, $Res Function(_$NightScheduleImpl) then) =
      __$$NightScheduleImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {bool isActive,
      @JsonKey(name: 'start_hour') int startHour,
      @JsonKey(name: 'end_hour') int endHour,
      @JsonKey(name: 'rate_multiplier') double rateMultiplier});
}

/// @nodoc
class __$$NightScheduleImplCopyWithImpl<$Res>
    extends _$NightScheduleCopyWithImpl<$Res, _$NightScheduleImpl>
    implements _$$NightScheduleImplCopyWith<$Res> {
  __$$NightScheduleImplCopyWithImpl(
      _$NightScheduleImpl _value, $Res Function(_$NightScheduleImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? isActive = null,
    Object? startHour = null,
    Object? endHour = null,
    Object? rateMultiplier = null,
  }) {
    return _then(_$NightScheduleImpl(
      isActive: null == isActive
          ? _value.isActive
          : isActive // ignore: cast_nullable_to_non_nullable
              as bool,
      startHour: null == startHour
          ? _value.startHour
          : startHour // ignore: cast_nullable_to_non_nullable
              as int,
      endHour: null == endHour
          ? _value.endHour
          : endHour // ignore: cast_nullable_to_non_nullable
              as int,
      rateMultiplier: null == rateMultiplier
          ? _value.rateMultiplier
          : rateMultiplier // ignore: cast_nullable_to_non_nullable
              as double,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$NightScheduleImpl implements _NightSchedule {
  const _$NightScheduleImpl(
      {required this.isActive,
      @JsonKey(name: 'start_hour') required this.startHour,
      @JsonKey(name: 'end_hour') required this.endHour,
      @JsonKey(name: 'rate_multiplier') required this.rateMultiplier});

  factory _$NightScheduleImpl.fromJson(Map<String, dynamic> json) =>
      _$$NightScheduleImplFromJson(json);

  @override
  final bool isActive;
// CORREGIDO: Usar lowerCamelCase y JsonKey.
  @override
  @JsonKey(name: 'start_hour')
  final int startHour;
  @override
  @JsonKey(name: 'end_hour')
  final int endHour;
  @override
  @JsonKey(name: 'rate_multiplier')
  final double rateMultiplier;

  @override
  String toString() {
    return 'NightSchedule(isActive: $isActive, startHour: $startHour, endHour: $endHour, rateMultiplier: $rateMultiplier)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$NightScheduleImpl &&
            (identical(other.isActive, isActive) ||
                other.isActive == isActive) &&
            (identical(other.startHour, startHour) ||
                other.startHour == startHour) &&
            (identical(other.endHour, endHour) || other.endHour == endHour) &&
            (identical(other.rateMultiplier, rateMultiplier) ||
                other.rateMultiplier == rateMultiplier));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode =>
      Object.hash(runtimeType, isActive, startHour, endHour, rateMultiplier);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$NightScheduleImplCopyWith<_$NightScheduleImpl> get copyWith =>
      __$$NightScheduleImplCopyWithImpl<_$NightScheduleImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$NightScheduleImplToJson(
      this,
    );
  }
}

abstract class _NightSchedule implements NightSchedule {
  const factory _NightSchedule(
      {required final bool isActive,
      @JsonKey(name: 'start_hour') required final int startHour,
      @JsonKey(name: 'end_hour') required final int endHour,
      @JsonKey(name: 'rate_multiplier')
      required final double rateMultiplier}) = _$NightScheduleImpl;

  factory _NightSchedule.fromJson(Map<String, dynamic> json) =
      _$NightScheduleImpl.fromJson;

  @override
  bool get isActive;
  @override // CORREGIDO: Usar lowerCamelCase y JsonKey.
  @JsonKey(name: 'start_hour')
  int get startHour;
  @override
  @JsonKey(name: 'end_hour')
  int get endHour;
  @override
  @JsonKey(name: 'rate_multiplier')
  double get rateMultiplier;
  @override
  @JsonKey(ignore: true)
  _$$NightScheduleImplCopyWith<_$NightScheduleImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_rate_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'service_rate_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$BaseRatesImpl _$$BaseRatesImplFromJson(Map<String, dynamic> json) =>
    _$BaseRatesImpl(
      servicioGruaKm: (json['servicio_grua_km'] as num?)?.toDouble(),
      auxilioGasolina: (json['auxilio_gasolina'] as num?)?.toDouble(),
      auxilioBateria: (json['auxilio_bateria'] as num?)?.toDouble(),
    );

Map<String, dynamic> _$$BaseRatesImplToJson(_$BaseRatesImpl instance) =>
    <String, dynamic>{
      'servicio_grua_km': instance.servicioGruaKm,
      'auxilio_gasolina': instance.auxilioGasolina,
      'auxilio_bateria': instance.auxilioBateria,
    };

_$SurchargesImpl _$$SurchargesImplFromJson(Map<String, dynamic> json) =>
    _$SurchargesImpl(
      vehiculoBlindado: (json['vehiculo_blindado'] as num?)?.toDouble(),
      sotano: (json['sotano'] as num?)?.toDouble(),
      cargaPesada: (json['carga_pesada'] as num?)?.toDouble(),
    );

Map<String, dynamic> _$$SurchargesImplToJson(_$SurchargesImpl instance) =>
    <String, dynamic>{
      'vehiculo_blindado': instance.vehiculoBlindado,
      'sotano': instance.sotano,
      'carga_pesada': instance.cargaPesada,
    };

_$NightScheduleImpl _$$NightScheduleImplFromJson(Map<String, dynamic> json) =>
    _$NightScheduleImpl(
      isActive: json['isActive'] as bool,
      startHour: (json['start_hour'] as num).toInt(),
      endHour: (json['end_hour'] as num).toInt(),
      rateMultiplier: (json['rate_multiplier'] as num).toDouble(),
    );

Map<String, dynamic> _$$NightScheduleImplToJson(_$NightScheduleImpl instance) =>
    <String, dynamic>{
      'isActive': instance.isActive,
      'start_hour': instance.startHour,
      'end_hour': instance.endHour,
      'rate_multiplier': instance.rateMultiplier,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';
// Importamos el archivo consolidado
import 'package:power_gruas/data/models/firestore_converters.dart';

part 'service_request_model.freezed.dart';
part 'service_request_model.g.dart';

@freezed
class ServiceRequestModel with _$ServiceRequestModel {
  const factory ServiceRequestModel({
    String? id,
    required String clientId,
    required String clientName,

    // CORREGIDO: Aplicamos el convertidor aquí
    @TimestampConverter()
    required Timestamp createdAt,

    required String status,
    required String requestOrigin,
    double? precioFinal,
    String? assignedGrueroId,
    String? assignedVehicleId,
    String? distanciaKm,

    // Usamos los convertidores para los GeoPoints
    @GeoPointConverter()
    required GeoPoint originLocation,
    required String originAddress,

    @NullableGeoPointConverter()
    GeoPoint? destinationLocation,
    String? destinationAddress,

    // Modelos anidados
    InsuredClientInfo? insuredClientInfo,
    PaymentDetails? paymentDetails,
    // Mapas dinámicos
    Map<String, dynamic>? serviceSpecificDetails,
    Map<String, String>? driverMediaUrls,

  }) = _ServiceRequestModel;

  factory ServiceRequestModel.fromJson(Map<String, dynamic> json) =>
      _$ServiceRequestModelFromJson(json);

  factory ServiceRequestModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) throw Exception("ServiceRequest document data is null");
     data['id'] = doc.id;
    return ServiceRequestModel.fromJson(data);
  }
}

// Modelos para los Mapas anidados (Estos permanecen igual)

@freezed
class InsuredClientInfo with _$InsuredClientInfo {
  const factory InsuredClientInfo({
    required String fullName,
    required String cedula,
    required String phone,
    String? cedulaPhotoUrl,
  }) = _InsuredClientInfo;

  factory InsuredClientInfo.fromJson(Map<String, dynamic> json) =>
      _$InsuredClientInfoFromJson(json);
}

@freezed
class PaymentDetails with _$PaymentDetails {
  const factory PaymentDetails({
    required String method,
    String? reference,
    String? photoUrl,
    String? bank,
    String? phone,
    String? cedula,
    String? email,
    double? amount,
  }) = _PaymentDetails;

    factory PaymentDetails.fromJson(Map<String, dynamic> json) =>
      _$PaymentDetailsFromJson(json);
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'service_request_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

ServiceRequestModel _$ServiceRequestModelFromJson(Map<String, dynamic> json) {
  return _ServiceRequestModel.fromJson(json);
}

/// @nodoc
mixin _$ServiceRequestModel {
  String? get id => throw _privateConstructorUsedError;
  String get clientId => throw _privateConstructorUsedError;
  String get clientName =>
      throw _privateConstructorUsedError; // CORREGIDO: Aplicamos el convertidor aquí
  @TimestampConverter()
  Timestamp get createdAt => throw _privateConstructorUsedError;
  String get status => throw _privateConstructorUsedError;
  String get requestOrigin => throw _privateConstructorUsedError;
  double? get precioFinal => throw _privateConstructorUsedError;
  String? get assignedGrueroId => throw _privateConstructorUsedError;
  String? get assignedVehicleId => throw _privateConstructorUsedError;
  String? get distanciaKm =>
      throw _privateConstructorUsedError; // Usamos los convertidores para los GeoPoints
  @GeoPointConverter()
  GeoPoint get originLocation => throw _privateConstructorUsedError;
  String get originAddress => throw _privateConstructorUsedError;
  @NullableGeoPointConverter()
  GeoPoint? get destinationLocation => throw _privateConstructorUsedError;
  String? get destinationAddress =>
      throw _privateConstructorUsedError; // Modelos anidados
  InsuredClientInfo? get insuredClientInfo =>
      throw _privateConstructorUsedError;
  PaymentDetails? get paymentDetails =>
      throw _privateConstructorUsedError; // Mapas dinámicos
  Map<String, dynamic>? get serviceSpecificDetails =>
      throw _privateConstructorUsedError;
  Map<String, String>? get driverMediaUrls =>
      throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $ServiceRequestModelCopyWith<ServiceRequestModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $ServiceRequestModelCopyWith<$Res> {
  factory $ServiceRequestModelCopyWith(
          ServiceRequestModel value, $Res Function(ServiceRequestModel) then) =
      _$ServiceRequestModelCopyWithImpl<$Res, ServiceRequestModel>;
  @useResult
  $Res call(
      {String? id,
      String clientId,
      String clientName,
      @TimestampConverter() Timestamp createdAt,
      String status,
      String requestOrigin,
      double? precioFinal,
      String? assignedGrueroId,
      String? assignedVehicleId,
      String? distanciaKm,
      @GeoPointConverter() GeoPoint originLocation,
      String originAddress,
      @NullableGeoPointConverter() GeoPoint? destinationLocation,
      String? destinationAddress,
      InsuredClientInfo? insuredClientInfo,
      PaymentDetails? paymentDetails,
      Map<String, dynamic>? serviceSpecificDetails,
      Map<String, String>? driverMediaUrls});

  $InsuredClientInfoCopyWith<$Res>? get insuredClientInfo;
  $PaymentDetailsCopyWith<$Res>? get paymentDetails;
}

/// @nodoc
class _$ServiceRequestModelCopyWithImpl<$Res, $Val extends ServiceRequestModel>
    implements $ServiceRequestModelCopyWith<$Res> {
  _$ServiceRequestModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? clientId = null,
    Object? clientName = null,
    Object? createdAt = null,
    Object? status = null,
    Object? requestOrigin = null,
    Object? precioFinal = freezed,
    Object? assignedGrueroId = freezed,
    Object? assignedVehicleId = freezed,
    Object? distanciaKm = freezed,
    Object? originLocation = null,
    Object? originAddress = null,
    Object? destinationLocation = freezed,
    Object? destinationAddress = freezed,
    Object? insuredClientInfo = freezed,
    Object? paymentDetails = freezed,
    Object? serviceSpecificDetails = freezed,
    Object? driverMediaUrls = freezed,
  }) {
    return _then(_value.copyWith(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      clientId: null == clientId
          ? _value.clientId
          : clientId // ignore: cast_nullable_to_non_nullable
              as String,
      clientName: null == clientName
          ? _value.clientName
          : clientName // ignore: cast_nullable_to_non_nullable
              as String,
      createdAt: null == createdAt
          ? _value.createdAt
          : createdAt // ignore: cast_nullable_to_non_nullable
              as Timestamp,
      status: null == status
          ? _value.status
          : status // ignore: cast_nullable_to_non_nullable
              as String,
      requestOrigin: null == requestOrigin
          ? _value.requestOrigin
          : requestOrigin // ignore: cast_nullable_to_non_nullable
              as String,
      precioFinal: freezed == precioFinal
          ? _value.precioFinal
          : precioFinal // ignore: cast_nullable_to_non_nullable
              as double?,
      assignedGrueroId: freezed == assignedGrueroId
          ? _value.assignedGrueroId
          : assignedGrueroId // ignore: cast_nullable_to_non_nullable
              as String?,
      assignedVehicleId: freezed == assignedVehicleId
          ? _value.assignedVehicleId
          : assignedVehicleId // ignore: cast_nullable_to_non_nullable
              as String?,
      distanciaKm: freezed == distanciaKm
          ? _value.distanciaKm
          : distanciaKm // ignore: cast_nullable_to_non_nullable
              as String?,
      originLocation: null == originLocation
          ? _value.originLocation
          : originLocation // ignore: cast_nullable_to_non_nullable
              as GeoPoint,
      originAddress: null == originAddress
          ? _value.originAddress
          : originAddress // ignore: cast_nullable_to_non_nullable
              as String,
      destinationLocation: freezed == destinationLocation
          ? _value.destinationLocation
          : destinationLocation // ignore: cast_nullable_to_non_nullable
              as GeoPoint?,
      destinationAddress: freezed == destinationAddress
          ? _value.destinationAddress
          : destinationAddress // ignore: cast_nullable_to_non_nullable
              as String?,
      insuredClientInfo: freezed == insuredClientInfo
          ? _value.insuredClientInfo
          : insuredClientInfo // ignore: cast_nullable_to_non_nullable
              as InsuredClientInfo?,
      paymentDetails: freezed == paymentDetails
          ? _value.paymentDetails
          : paymentDetails // ignore: cast_nullable_to_non_nullable
              as PaymentDetails?,
      serviceSpecificDetails: freezed == serviceSpecificDetails
          ? _value.serviceSpecificDetails
          : serviceSpecificDetails // ignore: cast_nullable_to_non_nullable
              as Map<String, dynamic>?,
      driverMediaUrls: freezed == driverMediaUrls
          ? _value.driverMediaUrls
          : driverMediaUrls // ignore: cast_nullable_to_non_nullable
              as Map<String, String>?,
    ) as $Val);
  }

  @override
  @pragma('vm:prefer-inline')
  $InsuredClientInfoCopyWith<$Res>? get insuredClientInfo {
    if (_value.insuredClientInfo == null) {
      return null;
    }

    return $InsuredClientInfoCopyWith<$Res>(_value.insuredClientInfo!, (value) {
      return _then(_value.copyWith(insuredClientInfo: value) as $Val);
    });
  }

  @override
  @pragma('vm:prefer-inline')
  $PaymentDetailsCopyWith<$Res>? get paymentDetails {
    if (_value.paymentDetails == null) {
      return null;
    }

    return $PaymentDetailsCopyWith<$Res>(_value.paymentDetails!, (value) {
      return _then(_value.copyWith(paymentDetails: value) as $Val);
    });
  }
}

/// @nodoc
abstract class _$$ServiceRequestModelImplCopyWith<$Res>
    implements $ServiceRequestModelCopyWith<$Res> {
  factory _$$ServiceRequestModelImplCopyWith(_$ServiceRequestModelImpl value,
          $Res Function(_$ServiceRequestModelImpl) then) =
      __$$ServiceRequestModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String? id,
      String clientId,
      String clientName,
      @TimestampConverter() Timestamp createdAt,
      String status,
      String requestOrigin,
      double? precioFinal,
      String? assignedGrueroId,
      String? assignedVehicleId,
      String? distanciaKm,
      @GeoPointConverter() GeoPoint originLocation,
      String originAddress,
      @NullableGeoPointConverter() GeoPoint? destinationLocation,
      String? destinationAddress,
      InsuredClientInfo? insuredClientInfo,
      PaymentDetails? paymentDetails,
      Map<String, dynamic>? serviceSpecificDetails,
      Map<String, String>? driverMediaUrls});

  @override
  $InsuredClientInfoCopyWith<$Res>? get insuredClientInfo;
  @override
  $PaymentDetailsCopyWith<$Res>? get paymentDetails;
}

/// @nodoc
class __$$ServiceRequestModelImplCopyWithImpl<$Res>
    extends _$ServiceRequestModelCopyWithImpl<$Res, _$ServiceRequestModelImpl>
    implements _$$ServiceRequestModelImplCopyWith<$Res> {
  __$$ServiceRequestModelImplCopyWithImpl(_$ServiceRequestModelImpl _value,
      $Res Function(_$ServiceRequestModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? clientId = null,
    Object? clientName = null,
    Object? createdAt = null,
    Object? status = null,
    Object? requestOrigin = null,
    Object? precioFinal = freezed,
    Object? assignedGrueroId = freezed,
    Object? assignedVehicleId = freezed,
    Object? distanciaKm = freezed,
    Object? originLocation = null,
    Object? originAddress = null,
    Object? destinationLocation = freezed,
    Object? destinationAddress = freezed,
    Object? insuredClientInfo = freezed,
    Object? paymentDetails = freezed,
    Object? serviceSpecificDetails = freezed,
    Object? driverMediaUrls = freezed,
  }) {
    return _then(_$ServiceRequestModelImpl(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      clientId: null == clientId
          ? _value.clientId
          : clientId // ignore: cast_nullable_to_non_nullable
              as String,
      clientName: null == clientName
          ? _value.clientName
          : clientName // ignore: cast_nullable_to_non_nullable
              as String,
      createdAt: null == createdAt
          ? _value.createdAt
          : createdAt // ignore: cast_nullable_to_non_nullable
              as Timestamp,
      status: null == status
          ? _value.status
          : status // ignore: cast_nullable_to_non_nullable
              as String,
      requestOrigin: null == requestOrigin
          ? _value.requestOrigin
          : requestOrigin // ignore: cast_nullable_to_non_nullable
              as String,
      precioFinal: freezed == precioFinal
          ? _value.precioFinal
          : precioFinal // ignore: cast_nullable_to_non_nullable
              as double?,
      assignedGrueroId: freezed == assignedGrueroId
          ? _value.assignedGrueroId
          : assignedGrueroId // ignore: cast_nullable_to_non_nullable
              as String?,
      assignedVehicleId: freezed == assignedVehicleId
          ? _value.assignedVehicleId
          : assignedVehicleId // ignore: cast_nullable_to_non_nullable
              as String?,
      distanciaKm: freezed == distanciaKm
          ? _value.distanciaKm
          : distanciaKm // ignore: cast_nullable_to_non_nullable
              as String?,
      originLocation: null == originLocation
          ? _value.originLocation
          : originLocation // ignore: cast_nullable_to_non_nullable
              as GeoPoint,
      originAddress: null == originAddress
          ? _value.originAddress
          : originAddress // ignore: cast_nullable_to_non_nullable
              as String,
      destinationLocation: freezed == destinationLocation
          ? _value.destinationLocation
          : destinationLocation // ignore: cast_nullable_to_non_nullable
              as GeoPoint?,
      destinationAddress: freezed == destinationAddress
          ? _value.destinationAddress
          : destinationAddress // ignore: cast_nullable_to_non_nullable
              as String?,
      insuredClientInfo: freezed == insuredClientInfo
          ? _value.insuredClientInfo
          : insuredClientInfo // ignore: cast_nullable_to_non_nullable
              as InsuredClientInfo?,
      paymentDetails: freezed == paymentDetails
          ? _value.paymentDetails
          : paymentDetails // ignore: cast_nullable_to_non_nullable
              as PaymentDetails?,
      serviceSpecificDetails: freezed == serviceSpecificDetails
          ? _value._serviceSpecificDetails
          : serviceSpecificDetails // ignore: cast_nullable_to_non_nullable
              as Map<String, dynamic>?,
      driverMediaUrls: freezed == driverMediaUrls
          ? _value._driverMediaUrls
          : driverMediaUrls // ignore: cast_nullable_to_non_nullable
              as Map<String, String>?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$ServiceRequestModelImpl implements _ServiceRequestModel {
  const _$ServiceRequestModelImpl(
      {this.id,
      required this.clientId,
      required this.clientName,
      @TimestampConverter() required this.createdAt,
      required this.status,
      required this.requestOrigin,
      this.precioFinal,
      this.assignedGrueroId,
      this.assignedVehicleId,
      this.distanciaKm,
      @GeoPointConverter() required this.originLocation,
      required this.originAddress,
      @NullableGeoPointConverter() this.destinationLocation,
      this.destinationAddress,
      this.insuredClientInfo,
      this.paymentDetails,
      final Map<String, dynamic>? serviceSpecificDetails,
      final Map<String, String>? driverMediaUrls})
      : _serviceSpecificDetails = serviceSpecificDetails,
        _driverMediaUrls = driverMediaUrls;

  factory _$ServiceRequestModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$ServiceRequestModelImplFromJson(json);

  @override
  final String? id;
  @override
  final String clientId;
  @override
  final String clientName;
// CORREGIDO: Aplicamos el convertidor aquí
  @override
  @TimestampConverter()
  final Timestamp createdAt;
  @override
  final String status;
  @override
  final String requestOrigin;
  @override
  final double? precioFinal;
  @override
  final String? assignedGrueroId;
  @override
  final String? assignedVehicleId;
  @override
  final String? distanciaKm;
// Usamos los convertidores para los GeoPoints
  @override
  @GeoPointConverter()
  final GeoPoint originLocation;
  @override
  final String originAddress;
  @override
  @NullableGeoPointConverter()
  final GeoPoint? destinationLocation;
  @override
  final String? destinationAddress;
// Modelos anidados
  @override
  final InsuredClientInfo? insuredClientInfo;
  @override
  final PaymentDetails? paymentDetails;
// Mapas dinámicos
  final Map<String, dynamic>? _serviceSpecificDetails;
// Mapas dinámicos
  @override
  Map<String, dynamic>? get serviceSpecificDetails {
    final value = _serviceSpecificDetails;
    if (value == null) return null;
    if (_serviceSpecificDetails is EqualUnmodifiableMapView)
      return _serviceSpecificDetails;
    // ignore: implicit_dynamic_type
    return EqualUnmodifiableMapView(value);
  }

  final Map<String, String>? _driverMediaUrls;
  @override
  Map<String, String>? get driverMediaUrls {
    final value = _driverMediaUrls;
    if (value == null) return null;
    if (_driverMediaUrls is EqualUnmodifiableMapView) return _driverMediaUrls;
    // ignore: implicit_dynamic_type
    return EqualUnmodifiableMapView(value);
  }

  @override
  String toString() {
    return 'ServiceRequestModel(id: $id, clientId: $clientId, clientName: $clientName, createdAt: $createdAt, status: $status, requestOrigin: $requestOrigin, precioFinal: $precioFinal, assignedGrueroId: $assignedGrueroId, assignedVehicleId: $assignedVehicleId, distanciaKm: $distanciaKm, originLocation: $originLocation, originAddress: $originAddress, destinationLocation: $destinationLocation, destinationAddress: $destinationAddress, insuredClientInfo: $insuredClientInfo, paymentDetails: $paymentDetails, serviceSpecificDetails: $serviceSpecificDetails, driverMediaUrls: $driverMediaUrls)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$ServiceRequestModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.clientId, clientId) ||
                other.clientId == clientId) &&
            (identical(other.clientName, clientName) ||
                other.clientName == clientName) &&
            (identical(other.createdAt, createdAt) ||
                other.createdAt == createdAt) &&
            (identical(other.status, status) || other.status == status) &&
            (identical(other.requestOrigin, requestOrigin) ||
                other.requestOrigin == requestOrigin) &&
            (identical(other.precioFinal, precioFinal) ||
                other.precioFinal == precioFinal) &&
            (identical(other.assignedGrueroId, assignedGrueroId) ||
                other.assignedGrueroId == assignedGrueroId) &&
            (identical(other.assignedVehicleId, assignedVehicleId) ||
                other.assignedVehicleId == assignedVehicleId) &&
            (identical(other.distanciaKm, distanciaKm) ||
                other.distanciaKm == distanciaKm) &&
            (identical(other.originLocation, originLocation) ||
                other.originLocation == originLocation) &&
            (identical(other.originAddress, originAddress) ||
                other.originAddress == originAddress) &&
            (identical(other.destinationLocation, destinationLocation) ||
                other.destinationLocation == destinationLocation) &&
            (identical(other.destinationAddress, destinationAddress) ||
                other.destinationAddress == destinationAddress) &&
            (identical(other.insuredClientInfo, insuredClientInfo) ||
                other.insuredClientInfo == insuredClientInfo) &&
            (identical(other.paymentDetails, paymentDetails) ||
                other.paymentDetails == paymentDetails) &&
            const DeepCollectionEquality().equals(
                other._serviceSpecificDetails, _serviceSpecificDetails) &&
            const DeepCollectionEquality()
                .equals(other._driverMediaUrls, _driverMediaUrls));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(
      runtimeType,
      id,
      clientId,
      clientName,
      createdAt,
      status,
      requestOrigin,
      precioFinal,
      assignedGrueroId,
      assignedVehicleId,
      distanciaKm,
      originLocation,
      originAddress,
      destinationLocation,
      destinationAddress,
      insuredClientInfo,
      paymentDetails,
      const DeepCollectionEquality().hash(_serviceSpecificDetails),
      const DeepCollectionEquality().hash(_driverMediaUrls));

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$ServiceRequestModelImplCopyWith<_$ServiceRequestModelImpl> get copyWith =>
      __$$ServiceRequestModelImplCopyWithImpl<_$ServiceRequestModelImpl>(
          this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$ServiceRequestModelImplToJson(
      this,
    );
  }
}

abstract class _ServiceRequestModel implements ServiceRequestModel {
  const factory _ServiceRequestModel(
      {final String? id,
      required final String clientId,
      required final String clientName,
      @TimestampConverter() required final Timestamp createdAt,
      required final String status,
      required final String requestOrigin,
      final double? precioFinal,
      final String? assignedGrueroId,
      final String? assignedVehicleId,
      final String? distanciaKm,
      @GeoPointConverter() required final GeoPoint originLocation,
      required final String originAddress,
      @NullableGeoPointConverter() final GeoPoint? destinationLocation,
      final String? destinationAddress,
      final InsuredClientInfo? insuredClientInfo,
      final PaymentDetails? paymentDetails,
      final Map<String, dynamic>? serviceSpecificDetails,
      final Map<String, String>? driverMediaUrls}) = _$ServiceRequestModelImpl;

  factory _ServiceRequestModel.fromJson(Map<String, dynamic> json) =
      _$ServiceRequestModelImpl.fromJson;

  @override
  String? get id;
  @override
  String get clientId;
  @override
  String get clientName;
  @override // CORREGIDO: Aplicamos el convertidor aquí
  @TimestampConverter()
  Timestamp get createdAt;
  @override
  String get status;
  @override
  String get requestOrigin;
  @override
  double? get precioFinal;
  @override
  String? get assignedGrueroId;
  @override
  String? get assignedVehicleId;
  @override
  String? get distanciaKm;
  @override // Usamos los convertidores para los GeoPoints
  @GeoPointConverter()
  GeoPoint get originLocation;
  @override
  String get originAddress;
  @override
  @NullableGeoPointConverter()
  GeoPoint? get destinationLocation;
  @override
  String? get destinationAddress;
  @override // Modelos anidados
  InsuredClientInfo? get insuredClientInfo;
  @override
  PaymentDetails? get paymentDetails;
  @override // Mapas dinámicos
  Map<String, dynamic>? get serviceSpecificDetails;
  @override
  Map<String, String>? get driverMediaUrls;
  @override
  @JsonKey(ignore: true)
  _$$ServiceRequestModelImplCopyWith<_$ServiceRequestModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

InsuredClientInfo _$InsuredClientInfoFromJson(Map<String, dynamic> json) {
  return _InsuredClientInfo.fromJson(json);
}

/// @nodoc
mixin _$InsuredClientInfo {
  String get fullName => throw _privateConstructorUsedError;
  String get cedula => throw _privateConstructorUsedError;
  String get phone => throw _privateConstructorUsedError;
  String? get cedulaPhotoUrl => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $InsuredClientInfoCopyWith<InsuredClientInfo> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $InsuredClientInfoCopyWith<$Res> {
  factory $InsuredClientInfoCopyWith(
          InsuredClientInfo value, $Res Function(InsuredClientInfo) then) =
      _$InsuredClientInfoCopyWithImpl<$Res, InsuredClientInfo>;
  @useResult
  $Res call(
      {String fullName, String cedula, String phone, String? cedulaPhotoUrl});
}

/// @nodoc
class _$InsuredClientInfoCopyWithImpl<$Res, $Val extends InsuredClientInfo>
    implements $InsuredClientInfoCopyWith<$Res> {
  _$InsuredClientInfoCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? fullName = null,
    Object? cedula = null,
    Object? phone = null,
    Object? cedulaPhotoUrl = freezed,
  }) {
    return _then(_value.copyWith(
      fullName: null == fullName
          ? _value.fullName
          : fullName // ignore: cast_nullable_to_non_nullable
              as String,
      cedula: null == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String,
      phone: null == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String,
      cedulaPhotoUrl: freezed == cedulaPhotoUrl
          ? _value.cedulaPhotoUrl
          : cedulaPhotoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$InsuredClientInfoImplCopyWith<$Res>
    implements $InsuredClientInfoCopyWith<$Res> {
  factory _$$InsuredClientInfoImplCopyWith(_$InsuredClientInfoImpl value,
          $Res Function(_$InsuredClientInfoImpl) then) =
      __$$InsuredClientInfoImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String fullName, String cedula, String phone, String? cedulaPhotoUrl});
}

/// @nodoc
class __$$InsuredClientInfoImplCopyWithImpl<$Res>
    extends _$InsuredClientInfoCopyWithImpl<$Res, _$InsuredClientInfoImpl>
    implements _$$InsuredClientInfoImplCopyWith<$Res> {
  __$$InsuredClientInfoImplCopyWithImpl(_$InsuredClientInfoImpl _value,
      $Res Function(_$InsuredClientInfoImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? fullName = null,
    Object? cedula = null,
    Object? phone = null,
    Object? cedulaPhotoUrl = freezed,
  }) {
    return _then(_$InsuredClientInfoImpl(
      fullName: null == fullName
          ? _value.fullName
          : fullName // ignore: cast_nullable_to_non_nullable
              as String,
      cedula: null == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String,
      phone: null == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String,
      cedulaPhotoUrl: freezed == cedulaPhotoUrl
          ? _value.cedulaPhotoUrl
          : cedulaPhotoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$InsuredClientInfoImpl implements _InsuredClientInfo {
  const _$InsuredClientInfoImpl(
      {required this.fullName,
      required this.cedula,
      required this.phone,
      this.cedulaPhotoUrl});

  factory _$InsuredClientInfoImpl.fromJson(Map<String, dynamic> json) =>
      _$$InsuredClientInfoImplFromJson(json);

  @override
  final String fullName;
  @override
  final String cedula;
  @override
  final String phone;
  @override
  final String? cedulaPhotoUrl;

  @override
  String toString() {
    return 'InsuredClientInfo(fullName: $fullName, cedula: $cedula, phone: $phone, cedulaPhotoUrl: $cedulaPhotoUrl)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$InsuredClientInfoImpl &&
            (identical(other.fullName, fullName) ||
                other.fullName == fullName) &&
            (identical(other.cedula, cedula) || other.cedula == cedula) &&
            (identical(other.phone, phone) || other.phone == phone) &&
            (identical(other.cedulaPhotoUrl, cedulaPhotoUrl) ||
                other.cedulaPhotoUrl == cedulaPhotoUrl));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode =>
      Object.hash(runtimeType, fullName, cedula, phone, cedulaPhotoUrl);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$InsuredClientInfoImplCopyWith<_$InsuredClientInfoImpl> get copyWith =>
      __$$InsuredClientInfoImplCopyWithImpl<_$InsuredClientInfoImpl>(
          this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$InsuredClientInfoImplToJson(
      this,
    );
  }
}

abstract class _InsuredClientInfo implements InsuredClientInfo {
  const factory _InsuredClientInfo(
      {required final String fullName,
      required final String cedula,
      required final String phone,
      final String? cedulaPhotoUrl}) = _$InsuredClientInfoImpl;

  factory _InsuredClientInfo.fromJson(Map<String, dynamic> json) =
      _$InsuredClientInfoImpl.fromJson;

  @override
  String get fullName;
  @override
  String get cedula;
  @override
  String get phone;
  @override
  String? get cedulaPhotoUrl;
  @override
  @JsonKey(ignore: true)
  _$$InsuredClientInfoImplCopyWith<_$InsuredClientInfoImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

PaymentDetails _$PaymentDetailsFromJson(Map<String, dynamic> json) {
  return _PaymentDetails.fromJson(json);
}

/// @nodoc
mixin _$PaymentDetails {
  String get method => throw _privateConstructorUsedError;
  String? get reference => throw _privateConstructorUsedError;
  String? get photoUrl => throw _privateConstructorUsedError;
  String? get bank => throw _privateConstructorUsedError;
  String? get phone => throw _privateConstructorUsedError;
  String? get cedula => throw _privateConstructorUsedError;
  String? get email => throw _privateConstructorUsedError;
  double? get amount => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $PaymentDetailsCopyWith<PaymentDetails> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $PaymentDetailsCopyWith<$Res> {
  factory $PaymentDetailsCopyWith(
          PaymentDetails value, $Res Function(PaymentDetails) then) =
      _$PaymentDetailsCopyWithImpl<$Res, PaymentDetails>;
  @useResult
  $Res call(
      {String method,
      String? reference,
      String? photoUrl,
      String? bank,
      String? phone,
      String? cedula,
      String? email,
      double? amount});
}

/// @nodoc
class _$PaymentDetailsCopyWithImpl<$Res, $Val extends PaymentDetails>
    implements $PaymentDetailsCopyWith<$Res> {
  _$PaymentDetailsCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? method = null,
    Object? reference = freezed,
    Object? photoUrl = freezed,
    Object? bank = freezed,
    Object? phone = freezed,
    Object? cedula = freezed,
    Object? email = freezed,
    Object? amount = freezed,
  }) {
    return _then(_value.copyWith(
      method: null == method
          ? _value.method
          : method // ignore: cast_nullable_to_non_nullable
              as String,
      reference: freezed == reference
          ? _value.reference
          : reference // ignore: cast_nullable_to_non_nullable
              as String?,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      bank: freezed == bank
          ? _value.bank
          : bank // ignore: cast_nullable_to_non_nullable
              as String?,
      phone: freezed == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String?,
      cedula: freezed == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String?,
      email: freezed == email
          ? _value.email
          : email // ignore: cast_nullable_to_non_nullable
              as String?,
      amount: freezed == amount
          ? _value.amount
          : amount // ignore: cast_nullable_to_non_nullable
              as double?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$PaymentDetailsImplCopyWith<$Res>
    implements $PaymentDetailsCopyWith<$Res> {
  factory _$$PaymentDetailsImplCopyWith(_$PaymentDetailsImpl value,
          $Res Function(_$PaymentDetailsImpl) then) =
      __$$PaymentDetailsImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String method,
      String? reference,
      String? photoUrl,
      String? bank,
      String? phone,
      String? cedula,
      String? email,
      double? amount});
}

/// @nodoc
class __$$PaymentDetailsImplCopyWithImpl<$Res>
    extends _$PaymentDetailsCopyWithImpl<$Res, _$PaymentDetailsImpl>
    implements _$$PaymentDetailsImplCopyWith<$Res> {
  __$$PaymentDetailsImplCopyWithImpl(
      _$PaymentDetailsImpl _value, $Res Function(_$PaymentDetailsImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? method = null,
    Object? reference = freezed,
    Object? photoUrl = freezed,
    Object? bank = freezed,
    Object? phone = freezed,
    Object? cedula = freezed,
    Object? email = freezed,
    Object? amount = freezed,
  }) {
    return _then(_$PaymentDetailsImpl(
      method: null == method
          ? _value.method
          : method // ignore: cast_nullable_to_non_nullable
              as String,
      reference: freezed == reference
          ? _value.reference
          : reference // ignore: cast_nullable_to_non_nullable
              as String?,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      bank: freezed == bank
          ? _value.bank
          : bank // ignore: cast_nullable_to_non_nullable
              as String?,
      phone: freezed == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String?,
      cedula: freezed == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String?,
      email: freezed == email
          ? _value.email
          : email // ignore: cast_nullable_to_non_nullable
              as String?,
      amount: freezed == amount
          ? _value.amount
          : amount // ignore: cast_nullable_to_non_nullable
              as double?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$PaymentDetailsImpl implements _PaymentDetails {
  const _$PaymentDetailsImpl(
      {required this.method,
      this.reference,
      this.photoUrl,
      this.bank,
      this.phone,
      this.cedula,
      this.email,
      this.amount});

  factory _$PaymentDetailsImpl.fromJson(Map<String, dynamic> json) =>
      _$$PaymentDetailsImplFromJson(json);

  @override
  final String method;
  @override
  final String? reference;
  @override
  final String? photoUrl;
  @override
  final String? bank;
  @override
  final String? phone;
  @override
  final String? cedula;
  @override
  final String? email;
  @override
  final double? amount;

  @override
  String toString() {
    return 'PaymentDetails(method: $method, reference: $reference, photoUrl: $photoUrl, bank: $bank, phone: $phone, cedula: $cedula, email: $email, amount: $amount)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$PaymentDetailsImpl &&
            (identical(other.method, method) || other.method == method) &&
            (identical(other.reference, reference) ||
                other.reference == reference) &&
            (identical(other.photoUrl, photoUrl) ||
                other.photoUrl == photoUrl) &&
            (identical(other.bank, bank) || other.bank == bank) &&
            (identical(other.phone, phone) || other.phone == phone) &&
            (identical(other.cedula, cedula) || other.cedula == cedula) &&
            (identical(other.email, email) || other.email == email) &&
            (identical(other.amount, amount) || other.amount == amount));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(runtimeType, method, reference, photoUrl,
      bank, phone, cedula, email, amount);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$PaymentDetailsImplCopyWith<_$PaymentDetailsImpl> get copyWith =>
      __$$PaymentDetailsImplCopyWithImpl<_$PaymentDetailsImpl>(
          this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$PaymentDetailsImplToJson(
      this,
    );
  }
}

abstract class _PaymentDetails implements PaymentDetails {
  const factory _PaymentDetails(
      {required final String method,
      final String? reference,
      final String? photoUrl,
      final String? bank,
      final String? phone,
      final String? cedula,
      final String? email,
      final double? amount}) = _$PaymentDetailsImpl;

  factory _PaymentDetails.fromJson(Map<String, dynamic> json) =
      _$PaymentDetailsImpl.fromJson;

  @override
  String get method;
  @override
  String? get reference;
  @override
  String? get photoUrl;
  @override
  String? get bank;
  @override
  String? get phone;
  @override
  String? get cedula;
  @override
  String? get email;
  @override
  double? get amount;
  @override
  @JsonKey(ignore: true)
  _$$PaymentDetailsImplCopyWith<_$PaymentDetailsImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\service_request_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'service_request_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$ServiceRequestModelImpl _$$ServiceRequestModelImplFromJson(
        Map<String, dynamic> json) =>
    _$ServiceRequestModelImpl(
      id: json['id'] as String?,
      clientId: json['clientId'] as String,
      clientName: json['clientName'] as String,
      createdAt:
          const TimestampConverter().fromJson(json['createdAt'] as Timestamp),
      status: json['status'] as String,
      requestOrigin: json['requestOrigin'] as String,
      precioFinal: (json['precioFinal'] as num?)?.toDouble(),
      assignedGrueroId: json['assignedGrueroId'] as String?,
      assignedVehicleId: json['assignedVehicleId'] as String?,
      distanciaKm: json['distanciaKm'] as String?,
      originLocation: const GeoPointConverter()
          .fromJson(json['originLocation'] as GeoPoint),
      originAddress: json['originAddress'] as String,
      destinationLocation: const NullableGeoPointConverter()
          .fromJson(json['destinationLocation'] as GeoPoint?),
      destinationAddress: json['destinationAddress'] as String?,
      insuredClientInfo: json['insuredClientInfo'] == null
          ? null
          : InsuredClientInfo.fromJson(
              json['insuredClientInfo'] as Map<String, dynamic>),
      paymentDetails: json['paymentDetails'] == null
          ? null
          : PaymentDetails.fromJson(
              json['paymentDetails'] as Map<String, dynamic>),
      serviceSpecificDetails:
          json['serviceSpecificDetails'] as Map<String, dynamic>?,
      driverMediaUrls: (json['driverMediaUrls'] as Map<String, dynamic>?)?.map(
        (k, e) => MapEntry(k, e as String),
      ),
    );

Map<String, dynamic> _$$ServiceRequestModelImplToJson(
        _$ServiceRequestModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'clientId': instance.clientId,
      'clientName': instance.clientName,
      'createdAt': const TimestampConverter().toJson(instance.createdAt),
      'status': instance.status,
      'requestOrigin': instance.requestOrigin,
      'precioFinal': instance.precioFinal,
      'assignedGrueroId': instance.assignedGrueroId,
      'assignedVehicleId': instance.assignedVehicleId,
      'distanciaKm': instance.distanciaKm,
      'originLocation':
          const GeoPointConverter().toJson(instance.originLocation),
      'originAddress': instance.originAddress,
      'destinationLocation': const NullableGeoPointConverter()
          .toJson(instance.destinationLocation),
      'destinationAddress': instance.destinationAddress,
      'insuredClientInfo': instance.insuredClientInfo,
      'paymentDetails': instance.paymentDetails,
      'serviceSpecificDetails': instance.serviceSpecificDetails,
      'driverMediaUrls': instance.driverMediaUrls,
    };

_$InsuredClientInfoImpl _$$InsuredClientInfoImplFromJson(
        Map<String, dynamic> json) =>
    _$InsuredClientInfoImpl(
      fullName: json['fullName'] as String,
      cedula: json['cedula'] as String,
      phone: json['phone'] as String,
      cedulaPhotoUrl: json['cedulaPhotoUrl'] as String?,
    );

Map<String, dynamic> _$$InsuredClientInfoImplToJson(
        _$InsuredClientInfoImpl instance) =>
    <String, dynamic>{
      'fullName': instance.fullName,
      'cedula': instance.cedula,
      'phone': instance.phone,
      'cedulaPhotoUrl': instance.cedulaPhotoUrl,
    };

_$PaymentDetailsImpl _$$PaymentDetailsImplFromJson(Map<String, dynamic> json) =>
    _$PaymentDetailsImpl(
      method: json['method'] as String,
      reference: json['reference'] as String?,
      photoUrl: json['photoUrl'] as String?,
      bank: json['bank'] as String?,
      phone: json['phone'] as String?,
      cedula: json['cedula'] as String?,
      email: json['email'] as String?,
      amount: (json['amount'] as num?)?.toDouble(),
    );

Map<String, dynamic> _$$PaymentDetailsImplToJson(
        _$PaymentDetailsImpl instance) =>
    <String, dynamic>{
      'method': instance.method,
      'reference': instance.reference,
      'photoUrl': instance.photoUrl,
      'bank': instance.bank,
      'phone': instance.phone,
      'cedula': instance.cedula,
      'email': instance.email,
      'amount': instance.amount,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
// Importamos el archivo consolidado
import 'package:power_gruas/data/models/firestore_converters.dart';

// Archivos generados por Freezed
part 'user_model.freezed.dart';
part 'user_model.g.dart';

@freezed
class UserModel with _$UserModel {
  const factory UserModel({
    required String id,
    required String fullName,
    required String email,
    required String phone,
    required String cedula,
    String? photoUrl,

    // CORREGIDO: Aplicamos el convertidor aquí
    @TimestampConverter()
    required Timestamp createdAt,

    required String role,
    String? codigoEmpleado,
    @Default(AppConstants.employeeStatusDisponible) String? employeeStatus,
  }) = _UserModel;

  factory UserModel.fromJson(Map<String, dynamic> json) =>
      _$UserModelFromJson(json);

  // Helper para crear el modelo desde un snapshot de Firestore
  factory UserModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
     if (data == null) throw Exception("User document data is null");
    data['id'] = doc.id;
    return UserModel.fromJson(data);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'user_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

UserModel _$UserModelFromJson(Map<String, dynamic> json) {
  return _UserModel.fromJson(json);
}

/// @nodoc
mixin _$UserModel {
  String get id => throw _privateConstructorUsedError;
  String get fullName => throw _privateConstructorUsedError;
  String get email => throw _privateConstructorUsedError;
  String get phone => throw _privateConstructorUsedError;
  String get cedula => throw _privateConstructorUsedError;
  String? get photoUrl =>
      throw _privateConstructorUsedError; // CORREGIDO: Aplicamos el convertidor aquí
  @TimestampConverter()
  Timestamp get createdAt => throw _privateConstructorUsedError;
  String get role => throw _privateConstructorUsedError;
  String? get codigoEmpleado => throw _privateConstructorUsedError;
  String? get employeeStatus => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $UserModelCopyWith<UserModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $UserModelCopyWith<$Res> {
  factory $UserModelCopyWith(UserModel value, $Res Function(UserModel) then) =
      _$UserModelCopyWithImpl<$Res, UserModel>;
  @useResult
  $Res call(
      {String id,
      String fullName,
      String email,
      String phone,
      String cedula,
      String? photoUrl,
      @TimestampConverter() Timestamp createdAt,
      String role,
      String? codigoEmpleado,
      String? employeeStatus});
}

/// @nodoc
class _$UserModelCopyWithImpl<$Res, $Val extends UserModel>
    implements $UserModelCopyWith<$Res> {
  _$UserModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = null,
    Object? fullName = null,
    Object? email = null,
    Object? phone = null,
    Object? cedula = null,
    Object? photoUrl = freezed,
    Object? createdAt = null,
    Object? role = null,
    Object? codigoEmpleado = freezed,
    Object? employeeStatus = freezed,
  }) {
    return _then(_value.copyWith(
      id: null == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String,
      fullName: null == fullName
          ? _value.fullName
          : fullName // ignore: cast_nullable_to_non_nullable
              as String,
      email: null == email
          ? _value.email
          : email // ignore: cast_nullable_to_non_nullable
              as String,
      phone: null == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String,
      cedula: null == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      createdAt: null == createdAt
          ? _value.createdAt
          : createdAt // ignore: cast_nullable_to_non_nullable
              as Timestamp,
      role: null == role
          ? _value.role
          : role // ignore: cast_nullable_to_non_nullable
              as String,
      codigoEmpleado: freezed == codigoEmpleado
          ? _value.codigoEmpleado
          : codigoEmpleado // ignore: cast_nullable_to_non_nullable
              as String?,
      employeeStatus: freezed == employeeStatus
          ? _value.employeeStatus
          : employeeStatus // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$UserModelImplCopyWith<$Res>
    implements $UserModelCopyWith<$Res> {
  factory _$$UserModelImplCopyWith(
          _$UserModelImpl value, $Res Function(_$UserModelImpl) then) =
      __$$UserModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String id,
      String fullName,
      String email,
      String phone,
      String cedula,
      String? photoUrl,
      @TimestampConverter() Timestamp createdAt,
      String role,
      String? codigoEmpleado,
      String? employeeStatus});
}

/// @nodoc
class __$$UserModelImplCopyWithImpl<$Res>
    extends _$UserModelCopyWithImpl<$Res, _$UserModelImpl>
    implements _$$UserModelImplCopyWith<$Res> {
  __$$UserModelImplCopyWithImpl(
      _$UserModelImpl _value, $Res Function(_$UserModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = null,
    Object? fullName = null,
    Object? email = null,
    Object? phone = null,
    Object? cedula = null,
    Object? photoUrl = freezed,
    Object? createdAt = null,
    Object? role = null,
    Object? codigoEmpleado = freezed,
    Object? employeeStatus = freezed,
  }) {
    return _then(_$UserModelImpl(
      id: null == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String,
      fullName: null == fullName
          ? _value.fullName
          : fullName // ignore: cast_nullable_to_non_nullable
              as String,
      email: null == email
          ? _value.email
          : email // ignore: cast_nullable_to_non_nullable
              as String,
      phone: null == phone
          ? _value.phone
          : phone // ignore: cast_nullable_to_non_nullable
              as String,
      cedula: null == cedula
          ? _value.cedula
          : cedula // ignore: cast_nullable_to_non_nullable
              as String,
      photoUrl: freezed == photoUrl
          ? _value.photoUrl
          : photoUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      createdAt: null == createdAt
          ? _value.createdAt
          : createdAt // ignore: cast_nullable_to_non_nullable
              as Timestamp,
      role: null == role
          ? _value.role
          : role // ignore: cast_nullable_to_non_nullable
              as String,
      codigoEmpleado: freezed == codigoEmpleado
          ? _value.codigoEmpleado
          : codigoEmpleado // ignore: cast_nullable_to_non_nullable
              as String?,
      employeeStatus: freezed == employeeStatus
          ? _value.employeeStatus
          : employeeStatus // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$UserModelImpl implements _UserModel {
  const _$UserModelImpl(
      {required this.id,
      required this.fullName,
      required this.email,
      required this.phone,
      required this.cedula,
      this.photoUrl,
      @TimestampConverter() required this.createdAt,
      required this.role,
      this.codigoEmpleado,
      this.employeeStatus = AppConstants.employeeStatusDisponible});

  factory _$UserModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$UserModelImplFromJson(json);

  @override
  final String id;
  @override
  final String fullName;
  @override
  final String email;
  @override
  final String phone;
  @override
  final String cedula;
  @override
  final String? photoUrl;
// CORREGIDO: Aplicamos el convertidor aquí
  @override
  @TimestampConverter()
  final Timestamp createdAt;
  @override
  final String role;
  @override
  final String? codigoEmpleado;
  @override
  @JsonKey()
  final String? employeeStatus;

  @override
  String toString() {
    return 'UserModel(id: $id, fullName: $fullName, email: $email, phone: $phone, cedula: $cedula, photoUrl: $photoUrl, createdAt: $createdAt, role: $role, codigoEmpleado: $codigoEmpleado, employeeStatus: $employeeStatus)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$UserModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.fullName, fullName) ||
                other.fullName == fullName) &&
            (identical(other.email, email) || other.email == email) &&
            (identical(other.phone, phone) || other.phone == phone) &&
            (identical(other.cedula, cedula) || other.cedula == cedula) &&
            (identical(other.photoUrl, photoUrl) ||
                other.photoUrl == photoUrl) &&
            (identical(other.createdAt, createdAt) ||
                other.createdAt == createdAt) &&
            (identical(other.role, role) || other.role == role) &&
            (identical(other.codigoEmpleado, codigoEmpleado) ||
                other.codigoEmpleado == codigoEmpleado) &&
            (identical(other.employeeStatus, employeeStatus) ||
                other.employeeStatus == employeeStatus));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(runtimeType, id, fullName, email, phone,
      cedula, photoUrl, createdAt, role, codigoEmpleado, employeeStatus);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$UserModelImplCopyWith<_$UserModelImpl> get copyWith =>
      __$$UserModelImplCopyWithImpl<_$UserModelImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$UserModelImplToJson(
      this,
    );
  }
}

abstract class _UserModel implements UserModel {
  const factory _UserModel(
      {required final String id,
      required final String fullName,
      required final String email,
      required final String phone,
      required final String cedula,
      final String? photoUrl,
      @TimestampConverter() required final Timestamp createdAt,
      required final String role,
      final String? codigoEmpleado,
      final String? employeeStatus}) = _$UserModelImpl;

  factory _UserModel.fromJson(Map<String, dynamic> json) =
      _$UserModelImpl.fromJson;

  @override
  String get id;
  @override
  String get fullName;
  @override
  String get email;
  @override
  String get phone;
  @override
  String get cedula;
  @override
  String? get photoUrl;
  @override // CORREGIDO: Aplicamos el convertidor aquí
  @TimestampConverter()
  Timestamp get createdAt;
  @override
  String get role;
  @override
  String? get codigoEmpleado;
  @override
  String? get employeeStatus;
  @override
  @JsonKey(ignore: true)
  _$$UserModelImplCopyWith<_$UserModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\user_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'user_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$UserModelImpl _$$UserModelImplFromJson(Map<String, dynamic> json) =>
    _$UserModelImpl(
      id: json['id'] as String,
      fullName: json['fullName'] as String,
      email: json['email'] as String,
      phone: json['phone'] as String,
      cedula: json['cedula'] as String,
      photoUrl: json['photoUrl'] as String?,
      createdAt:
          const TimestampConverter().fromJson(json['createdAt'] as Timestamp),
      role: json['role'] as String,
      codigoEmpleado: json['codigoEmpleado'] as String?,
      employeeStatus: json['employeeStatus'] as String? ??
          AppConstants.employeeStatusDisponible,
    );

Map<String, dynamic> _$$UserModelImplToJson(_$UserModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'fullName': instance.fullName,
      'email': instance.email,
      'phone': instance.phone,
      'cedula': instance.cedula,
      'photoUrl': instance.photoUrl,
      'createdAt': const TimestampConverter().toJson(instance.createdAt),
      'role': instance.role,
      'codigoEmpleado': instance.codigoEmpleado,
      'employeeStatus': instance.employeeStatus,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:freezed_annotation/freezed_annotation.dart';

part 'vehicle_model.freezed.dart';
part 'vehicle_model.g.dart';

@freezed
class VehicleModel with _$VehicleModel {
  const factory VehicleModel({
    String? id, // ID del documento en la subcolección
    required String marca,
    required String modelo,
    required int anio,
    required String placa,
    required bool esDueno,
    String? carnetCirculacionUrl,
    String? cedulaUrl,
  }) = _VehicleModel;

  factory VehicleModel.fromJson(Map<String, dynamic> json) =>
      _$VehicleModelFromJson(json);

  factory VehicleModel.fromFirestore(DocumentSnapshot doc) {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) throw Exception("Vehicle document data is null");
    data['id'] = doc.id;
    return VehicleModel.fromJson(data);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.freezed.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.freezed.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.freezed.dart
========================================
.
// coverage:ignore-file
// GENERATED CODE - DO NOT MODIFY BY HAND
// ignore_for_file: type=lint
// ignore_for_file: unused_element, deprecated_member_use, deprecated_member_use_from_same_package, use_function_type_syntax_for_parameters, unnecessary_const, avoid_init_to_null, invalid_override_different_default_values_named, prefer_expression_function_bodies, annotate_overrides, invalid_annotation_target, unnecessary_question_mark

part of 'vehicle_model.dart';

// **************************************************************************
// FreezedGenerator
// **************************************************************************

T _$identity<T>(T value) => value;

final _privateConstructorUsedError = UnsupportedError(
    'It seems like you constructed your class using `MyClass._()`. This constructor is only meant to be used by freezed and you are not supposed to need it nor use it.\nPlease check the documentation here for more information: https://github.com/rrousselGit/freezed#adding-getters-and-methods-to-our-models');

VehicleModel _$VehicleModelFromJson(Map<String, dynamic> json) {
  return _VehicleModel.fromJson(json);
}

/// @nodoc
mixin _$VehicleModel {
  String? get id =>
      throw _privateConstructorUsedError; // ID del documento en la subcolección
  String get marca => throw _privateConstructorUsedError;
  String get modelo => throw _privateConstructorUsedError;
  int get anio => throw _privateConstructorUsedError;
  String get placa => throw _privateConstructorUsedError;
  bool get esDueno => throw _privateConstructorUsedError;
  String? get carnetCirculacionUrl => throw _privateConstructorUsedError;
  String? get cedulaUrl => throw _privateConstructorUsedError;

  Map<String, dynamic> toJson() => throw _privateConstructorUsedError;
  @JsonKey(ignore: true)
  $VehicleModelCopyWith<VehicleModel> get copyWith =>
      throw _privateConstructorUsedError;
}

/// @nodoc
abstract class $VehicleModelCopyWith<$Res> {
  factory $VehicleModelCopyWith(
          VehicleModel value, $Res Function(VehicleModel) then) =
      _$VehicleModelCopyWithImpl<$Res, VehicleModel>;
  @useResult
  $Res call(
      {String? id,
      String marca,
      String modelo,
      int anio,
      String placa,
      bool esDueno,
      String? carnetCirculacionUrl,
      String? cedulaUrl});
}

/// @nodoc
class _$VehicleModelCopyWithImpl<$Res, $Val extends VehicleModel>
    implements $VehicleModelCopyWith<$Res> {
  _$VehicleModelCopyWithImpl(this._value, this._then);

  // ignore: unused_field
  final $Val _value;
  // ignore: unused_field
  final $Res Function($Val) _then;

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? marca = null,
    Object? modelo = null,
    Object? anio = null,
    Object? placa = null,
    Object? esDueno = null,
    Object? carnetCirculacionUrl = freezed,
    Object? cedulaUrl = freezed,
  }) {
    return _then(_value.copyWith(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      marca: null == marca
          ? _value.marca
          : marca // ignore: cast_nullable_to_non_nullable
              as String,
      modelo: null == modelo
          ? _value.modelo
          : modelo // ignore: cast_nullable_to_non_nullable
              as String,
      anio: null == anio
          ? _value.anio
          : anio // ignore: cast_nullable_to_non_nullable
              as int,
      placa: null == placa
          ? _value.placa
          : placa // ignore: cast_nullable_to_non_nullable
              as String,
      esDueno: null == esDueno
          ? _value.esDueno
          : esDueno // ignore: cast_nullable_to_non_nullable
              as bool,
      carnetCirculacionUrl: freezed == carnetCirculacionUrl
          ? _value.carnetCirculacionUrl
          : carnetCirculacionUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      cedulaUrl: freezed == cedulaUrl
          ? _value.cedulaUrl
          : cedulaUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ) as $Val);
  }
}

/// @nodoc
abstract class _$$VehicleModelImplCopyWith<$Res>
    implements $VehicleModelCopyWith<$Res> {
  factory _$$VehicleModelImplCopyWith(
          _$VehicleModelImpl value, $Res Function(_$VehicleModelImpl) then) =
      __$$VehicleModelImplCopyWithImpl<$Res>;
  @override
  @useResult
  $Res call(
      {String? id,
      String marca,
      String modelo,
      int anio,
      String placa,
      bool esDueno,
      String? carnetCirculacionUrl,
      String? cedulaUrl});
}

/// @nodoc
class __$$VehicleModelImplCopyWithImpl<$Res>
    extends _$VehicleModelCopyWithImpl<$Res, _$VehicleModelImpl>
    implements _$$VehicleModelImplCopyWith<$Res> {
  __$$VehicleModelImplCopyWithImpl(
      _$VehicleModelImpl _value, $Res Function(_$VehicleModelImpl) _then)
      : super(_value, _then);

  @pragma('vm:prefer-inline')
  @override
  $Res call({
    Object? id = freezed,
    Object? marca = null,
    Object? modelo = null,
    Object? anio = null,
    Object? placa = null,
    Object? esDueno = null,
    Object? carnetCirculacionUrl = freezed,
    Object? cedulaUrl = freezed,
  }) {
    return _then(_$VehicleModelImpl(
      id: freezed == id
          ? _value.id
          : id // ignore: cast_nullable_to_non_nullable
              as String?,
      marca: null == marca
          ? _value.marca
          : marca // ignore: cast_nullable_to_non_nullable
              as String,
      modelo: null == modelo
          ? _value.modelo
          : modelo // ignore: cast_nullable_to_non_nullable
              as String,
      anio: null == anio
          ? _value.anio
          : anio // ignore: cast_nullable_to_non_nullable
              as int,
      placa: null == placa
          ? _value.placa
          : placa // ignore: cast_nullable_to_non_nullable
              as String,
      esDueno: null == esDueno
          ? _value.esDueno
          : esDueno // ignore: cast_nullable_to_non_nullable
              as bool,
      carnetCirculacionUrl: freezed == carnetCirculacionUrl
          ? _value.carnetCirculacionUrl
          : carnetCirculacionUrl // ignore: cast_nullable_to_non_nullable
              as String?,
      cedulaUrl: freezed == cedulaUrl
          ? _value.cedulaUrl
          : cedulaUrl // ignore: cast_nullable_to_non_nullable
              as String?,
    ));
  }
}

/// @nodoc
@JsonSerializable()
class _$VehicleModelImpl implements _VehicleModel {
  const _$VehicleModelImpl(
      {this.id,
      required this.marca,
      required this.modelo,
      required this.anio,
      required this.placa,
      required this.esDueno,
      this.carnetCirculacionUrl,
      this.cedulaUrl});

  factory _$VehicleModelImpl.fromJson(Map<String, dynamic> json) =>
      _$$VehicleModelImplFromJson(json);

  @override
  final String? id;
// ID del documento en la subcolección
  @override
  final String marca;
  @override
  final String modelo;
  @override
  final int anio;
  @override
  final String placa;
  @override
  final bool esDueno;
  @override
  final String? carnetCirculacionUrl;
  @override
  final String? cedulaUrl;

  @override
  String toString() {
    return 'VehicleModel(id: $id, marca: $marca, modelo: $modelo, anio: $anio, placa: $placa, esDueno: $esDueno, carnetCirculacionUrl: $carnetCirculacionUrl, cedulaUrl: $cedulaUrl)';
  }

  @override
  bool operator ==(Object other) {
    return identical(this, other) ||
        (other.runtimeType == runtimeType &&
            other is _$VehicleModelImpl &&
            (identical(other.id, id) || other.id == id) &&
            (identical(other.marca, marca) || other.marca == marca) &&
            (identical(other.modelo, modelo) || other.modelo == modelo) &&
            (identical(other.anio, anio) || other.anio == anio) &&
            (identical(other.placa, placa) || other.placa == placa) &&
            (identical(other.esDueno, esDueno) || other.esDueno == esDueno) &&
            (identical(other.carnetCirculacionUrl, carnetCirculacionUrl) ||
                other.carnetCirculacionUrl == carnetCirculacionUrl) &&
            (identical(other.cedulaUrl, cedulaUrl) ||
                other.cedulaUrl == cedulaUrl));
  }

  @JsonKey(ignore: true)
  @override
  int get hashCode => Object.hash(runtimeType, id, marca, modelo, anio, placa,
      esDueno, carnetCirculacionUrl, cedulaUrl);

  @JsonKey(ignore: true)
  @override
  @pragma('vm:prefer-inline')
  _$$VehicleModelImplCopyWith<_$VehicleModelImpl> get copyWith =>
      __$$VehicleModelImplCopyWithImpl<_$VehicleModelImpl>(this, _$identity);

  @override
  Map<String, dynamic> toJson() {
    return _$$VehicleModelImplToJson(
      this,
    );
  }
}

abstract class _VehicleModel implements VehicleModel {
  const factory _VehicleModel(
      {final String? id,
      required final String marca,
      required final String modelo,
      required final int anio,
      required final String placa,
      required final bool esDueno,
      final String? carnetCirculacionUrl,
      final String? cedulaUrl}) = _$VehicleModelImpl;

  factory _VehicleModel.fromJson(Map<String, dynamic> json) =
      _$VehicleModelImpl.fromJson;

  @override
  String? get id;
  @override // ID del documento en la subcolección
  String get marca;
  @override
  String get modelo;
  @override
  int get anio;
  @override
  String get placa;
  @override
  bool get esDueno;
  @override
  String? get carnetCirculacionUrl;
  @override
  String? get cedulaUrl;
  @override
  @JsonKey(ignore: true)
  _$$VehicleModelImplCopyWith<_$VehicleModelImpl> get copyWith =>
      throw _privateConstructorUsedError;
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\models\vehicle_model.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'vehicle_model.dart';

// **************************************************************************
// JsonSerializableGenerator
// **************************************************************************

_$VehicleModelImpl _$$VehicleModelImplFromJson(Map<String, dynamic> json) =>
    _$VehicleModelImpl(
      id: json['id'] as String?,
      marca: json['marca'] as String,
      modelo: json['modelo'] as String,
      anio: (json['anio'] as num).toInt(),
      placa: json['placa'] as String,
      esDueno: json['esDueno'] as bool,
      carnetCirculacionUrl: json['carnetCirculacionUrl'] as String?,
      cedulaUrl: json['cedulaUrl'] as String?,
    );

Map<String, dynamic> _$$VehicleModelImplToJson(_$VehicleModelImpl instance) =>
    <String, dynamic>{
      'id': instance.id,
      'marca': instance.marca,
      'modelo': instance.modelo,
      'anio': instance.anio,
      'placa': instance.placa,
      'esDueno': instance.esDueno,
      'carnetCirculacionUrl': instance.carnetCirculacionUrl,
      'cedulaUrl': instance.cedulaUrl,
    };

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\repositories\auth_repository_impl.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\repositories\auth_repository_impl.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\repositories\auth_repository_impl.dart
========================================
.
import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/data/datasources/auth_remote_datasource.dart';
import 'package:power_gruas/data/datasources/firestore_datasource.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/domain/repositories/auth_repository.dart';

final authRepositoryProvider = Provider<AuthRepository>((ref) {
  return AuthRepositoryImpl(
    ref.watch(authRemoteDataSourceProvider),
    ref.watch(firestoreDataSourceProvider),
  );
});

class AuthRepositoryImpl implements AuthRepository {
  final AuthRemoteDataSource _authDataSource;
  final FirestoreDataSource _firestoreDataSource;

  AuthRepositoryImpl(this._authDataSource, this._firestoreDataSource);

  @override
  Stream<User?> get authStateChanges => _authDataSource.authStateChanges;

  @override
  User? get currentUser => _authDataSource.currentUser;

  @override
  Future<UserModel> signIn(String email, String password) async {
    // La gestión de errores de Auth se centralizará en el AuthController
    UserCredential userCredential = await _authDataSource.signInWithEmailAndPassword(email, password);
    User user = userCredential.user!;
    // Verificamos que el perfil exista en Firestore
    return await _getUserData(user.uid);
  }

  @override
  Future<UserModel> signUp(UserModel newUser, String password) async {
    try {
      // 1. Crear usuario en Firebase Auth
      UserCredential userCredential = await _authDataSource.createUserWithEmailAndPassword(newUser.email, password);
      User user = userCredential.user!;

      // 2. Crear perfil en Firestore
      UserModel userProfile = newUser.copyWith(
        id: user.uid,
        createdAt: Timestamp.now(),
      );

      // Convertimos el modelo a JSON, excluyendo el campo 'id' ya que es el ID del documento
      final userData = userProfile.toJson();
      userData.remove('id');

      await _firestoreDataSource.setDocument('users', user.uid, userData);

      // Opcional: Enviar correo de bienvenida (escribiendo en la colección 'mail')
      // await _sendWelcomeEmail(userProfile.email, userProfile.fullName);

      return userProfile;
    } catch (e) {
      // Si falla la creación en Firestore (y no es un error de Auth previo), limpiamos Auth
      if (_authDataSource.currentUser != null && e is! FirebaseAuthException) {
        await _authDataSource.currentUser!.delete();
      }
      rethrow;
    }
  }

  @override
  Future<void> signOut() async {
    await _authDataSource.signOut();
  }

  // Implementación del restablecimiento de contraseña
  @override
  Future<void> resetPassword(String email) async {
    await _authDataSource.sendPasswordResetEmail(email);
  }

  @override
  Future<UserModel?> getCurrentUserdata() async {
    if (currentUser != null) {
      return await _getUserData(currentUser!.uid);
    }
    return null;
  }


  // --- Helpers Privados ---

  Future<UserModel> _getUserData(String uid) async {
    DocumentSnapshot doc = await _firestoreDataSource.getDocument('users', uid);
    if (doc.exists) {
      return UserModel.fromFirestore(doc);
    } else {
      // Si el perfil no existe en Firestore, cerramos la sesión por seguridad.
      await signOut();
      throw Exception("Perfil de usuario no encontrado en la base de datos.");
    }
  }

  // Implementación del envío de correo de bienvenida (Opcional)
  /*
  Future<void> _sendWelcomeEmail(String email, String fullName) async {
     await _firestoreDataSource.addDocument('mail', {
        'to': email,
        'template': {
          'name': 'welcome',
          'data': {
            'displayName': fullName,
          }
        }
      });
  }
  */
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\repositories\user_repository_impl.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\data\repositories\user_repository_impl.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\data\repositories\user_repository_impl.dart
========================================
.
import 'dart:io';
// import 'package:cloud_firestore/cloud_firestore.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/data/datasources/firestore_datasource.dart';
import 'package:power_gruas/data/datasources/storage_datasource.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/data/models/vehicle_model.dart';
import 'package:power_gruas/domain/repositories/user_repository.dart';

final userRepositoryProvider = Provider<UserRepository>((ref) {
  return UserRepositoryImpl(
    ref.watch(firestoreDataSourceProvider),
    ref.watch(storageDataSourceProvider),
  );
});

class UserRepositoryImpl implements UserRepository {
  final FirestoreDataSource _firestoreDataSource;
  final StorageDataSource _storageDataSource;

  UserRepositoryImpl(this._firestoreDataSource, this._storageDataSource);

  // --- Gestión de Usuario Básico ---

  @override
  Future<UserModel> getUser(String userId) async {
    final doc = await _firestoreDataSource.getDocument('users', userId);
    return UserModel.fromFirestore(doc);
  }

  @override
  Stream<UserModel> streamUser(String userId) {
    return _firestoreDataSource.streamDocument('users', userId).map((doc) => UserModel.fromFirestore(doc));
  }

  @override
  Future<void> updateUser(String userId, Map<String, dynamic> data) async {
    await _firestoreDataSource.updateDocument('users', userId, data);
  }

  @override
  Future<String> uploadProfilePicture(String userId, File image) async {
    final downloadUrl = await _storageDataSource.uploadFile(image, 'user_profiles/$userId/');
    await updateUser(userId, {'photoUrl': downloadUrl});
    return downloadUrl;
  }

  // --- Gestión de Vehículos ---

  @override
  Stream<List<VehicleModel>> streamUserVehicles(String userId) {
    return _firestoreDataSource.streamSubCollection('users', userId, 'vehicles')
        .map((snapshot) => snapshot.docs.map((doc) => VehicleModel.fromFirestore(doc)).toList());
  }

  @override
  Future<void> addVehicle(String userId, VehicleModel vehicle) async {
    final vehicleData = vehicle.copyWith(placa: vehicle.placa.toUpperCase()).toJson();
    vehicleData.remove('id');
    await _firestoreDataSource.addSubCollectionDocument('users', userId, 'vehicles', vehicleData);
  }

  @override
  Future<void> updateVehicle(String userId, VehicleModel vehicle) async {
     final vehicleData = vehicle.copyWith(placa: vehicle.placa.toUpperCase()).toJson();
     vehicleData.remove('id');
     await _firestoreDataSource.updateSubCollectionDocument('users', userId, 'vehicles', vehicle.id!, vehicleData);
  }

  @override
  Future<void> deleteVehicle(String userId, String vehicleId) async {
    await _firestoreDataSource.deleteSubCollectionDocument('users', userId, 'vehicles', vehicleId);
  }

  @override
  Future<String> uploadVehicleDocument(String userId, String vehicleId, File image, String docType) async {
     final downloadUrl = await _storageDataSource.uploadFile(image, 'vehicle_documents/$userId/$vehicleId/');

     String fieldName;
     if (docType == 'carnet') {
       fieldName = 'carnetCirculacionUrl';
     } else if (docType == 'cedula') {
       fieldName = 'cedulaUrl';
     } else {
       throw Exception('Invalid document type');
     }

     await _firestoreDataSource.updateSubCollectionDocument('users', userId, 'vehicles', vehicleId, {fieldName: downloadUrl});
     return downloadUrl;
  }


  // --- Admin: Gestión de Personal ---

  @override
  Future<List<UserModel>> searchUsers(String query) async {
    // Búsqueda básica por email en Firestore.
    final snapshot = await _firestoreDataSource.getCollection('users', queryBuilder: (q) {
      // CORREGIDO: Uso de interpolación de strings ($query) en lugar de concatenación (+).
      return q.where('email', isGreaterThanOrEqualTo: query).where('email', isLessThanOrEqualTo: '$query\uf8ff');
    });

    return snapshot.docs.map((doc) => UserModel.fromFirestore(doc)).toList();
  }

  @override
  Future<void> updateUserRole(String userId, String newRole, String? codigoEmpleado) async {
    Map<String, dynamic> data = {'role': newRole};
    if (codigoEmpleado != null) {
      data['codigoEmpleado'] = codigoEmpleado;
    }
    await _firestoreDataSource.updateDocument('users', userId, data);
  }

  @override
  Future<void> updateUserStatus(String userId, String newStatus) async {
     await _firestoreDataSource.updateDocument('users', userId, {'employeeStatus': newStatus});
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\auth_repository.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\auth_repository.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\auth_repository.dart
========================================
.
import 'package:firebase_auth/firebase_auth.dart';
import 'package:power_gruas/data/models/user_model.dart';

abstract class AuthRepository {
  Stream<User?> get authStateChanges;
  User? get currentUser;
  Future<UserModel> signIn(String email, String password);
  Future<UserModel> signUp(UserModel newUser, String password);
  Future<void> signOut();
  Future<UserModel?> getCurrentUserdata();
  Future<void> resetPassword(String email); // (Consideración 4)
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\user_repository.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\user_repository.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\domain\repositories\user_repository.dart
========================================
.
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/data/models/vehicle_model.dart';
import 'dart:io';

abstract class UserRepository {
  Future<UserModel> getUser(String userId);
  Stream<UserModel> streamUser(String userId);
  Future<void> updateUser(String userId, Map<String, dynamic> data);
  Future<String> uploadProfilePicture(String userId, File image);

  // Gestión de Vehículos
  Stream<List<VehicleModel>> streamUserVehicles(String userId);
  Future<void> addVehicle(String userId, VehicleModel vehicle);
  Future<void> updateVehicle(String userId, VehicleModel vehicle);
  Future<void> deleteVehicle(String userId, String vehicleId);
  Future<String> uploadVehicleDocument(String userId, String vehicleId, File image, String docType); // 'carnet' o 'cedula'

  // Admin: Gestión de Personal
  Future<List<UserModel>> searchUsers(String query);
  Future<void> updateUserRole(String userId, String newRole, String? codigoEmpleado);
  Future<void> updateUserStatus(String userId, String newStatus);
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.dart
========================================
.
import 'package:firebase_auth/firebase_auth.dart';
// CORREGIDO: Se elimina el import innecesario de flutter_riverpod ya que riverpod_annotation lo incluye.
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/data/repositories/auth_repository_impl.dart';
import 'package:power_gruas/domain/repositories/auth_repository.dart';
import 'package:riverpod_annotation/riverpod_annotation.dart';

part 'auth_controller.g.dart';

// Clase de excepción personalizada para errores de autenticación amigables
class AuthException implements Exception {
  final String message;
  // Añadimos un flag para saber si debemos activar la animación de "shake"
  final bool isCredentialsError;

  AuthException(this.message, {this.isCredentialsError = false});

  @override
  String toString() => message;
}

// AsyncNotifier que maneja las acciones de autenticación (Lógica de Negocio)
@riverpod
class AuthController extends _$AuthController {
  late final AuthRepository _authRepository;

  @override
  FutureOr<void> build() {
    // Inicializamos el repositorio
    _authRepository = ref.watch(authRepositoryProvider);
    // No necesitamos estado inicial
  }

  // ... (Métodos signIn, signUp, signOut, resetPassword permanecen igual) ...
    Future<void> signIn(String email, String password) async {
    // Usamos AsyncValue.guard para manejar el Future y atrapar excepciones
    state = await AsyncValue.guard(() async {
      try {
        await _authRepository.signIn(email, password);
        // Si tiene éxito, no retornamos nada. authStateChangesProvider actualizará la UI.
      } on FirebaseAuthException catch (e) {
        // Manejo específico de errores de Firebase Auth
        if (e.code == 'user-not-found' || e.code == 'wrong-password' || e.code == 'invalid-credential') {
          // Consideración 4: Mensaje específico y flag para animación
          throw AuthException('La contraseña o el correo ingresado son incorrectos.', isCredentialsError: true);
        } else if (e.code == 'invalid-email') {
          throw AuthException('El formato del correo electrónico no es válido.');
        } else {
          throw AuthException('Ocurrió un error de autenticación. Inténtalo de nuevo.');
        }
      } catch (e) {
        // Otros errores (ej. red, perfil de Firestore no encontrado)
        throw AuthException(e.toString());
      }
    });
  }

  Future<void> signUp(UserModel newUser, String password) async {
    state = await AsyncValue.guard(() async {
       try {
        await _authRepository.signUp(newUser, password);
      } on FirebaseAuthException catch (e) {
        if (e.code == 'email-already-in-use') {
          throw AuthException('El correo electrónico ya está registrado.');
        } else if (e.code == 'weak-password') {
          throw AuthException('La contraseña es demasiado débil.');
        }
        throw AuthException('Ocurrió un error en el registro. Inténtalo de nuevo.');
      } catch (e) {
        throw AuthException(e.toString());
      }
    });
  }

  Future<void> signOut() async {
    state = await AsyncValue.guard(() async {
      await _authRepository.signOut();
    });
  }

  // Método para restablecer contraseña (Consideración 4)
  Future<void> resetPassword(String email) async {
    state = await AsyncValue.guard(() async {
      try {
        await _authRepository.resetPassword(email);
      } on FirebaseAuthException catch (e) {
        // Indicar si el correo proporcionado es errado
        if (e.code == 'user-not-found') {
          throw AuthException('No se encontró un usuario con ese correo electrónico.');
        }
        throw AuthException('Error al enviar el correo de restablecimiento.');
      } catch (e) {
         throw AuthException(e.toString());
      }
    });
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_controller.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'auth_controller.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

String _$authControllerHash() => r'1a4c82ac15b5d9b108d93bc2426300f3b509390e';

/// See also [AuthController].
@ProviderFor(AuthController)
final authControllerProvider =
    AutoDisposeAsyncNotifierProvider<AuthController, void>.internal(
  AuthController.new,
  name: r'authControllerProvider',
  debugGetCreateSourceHash: const bool.fromEnvironment('dart.vm.product')
      ? null
      : _$authControllerHash,
  dependencies: null,
  allTransitiveDependencies: null,
);

typedef _$AuthController = AutoDisposeAsyncNotifier<void>;
// ignore_for_file: type=lint
// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.dart
========================================
.
import 'package:firebase_auth/firebase_auth.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/data/repositories/auth_repository_impl.dart';
// import 'package:power_gruas/domain/repositories/auth_repository.dart'; // No necesario aquí
import 'package:riverpod_annotation/riverpod_annotation.dart';


part 'auth_provider.g.dart';

// Expone el Stream de cambios de estado de Firebase Auth
@riverpod
Stream<User?> authStateChanges(AuthStateChangesRef ref) {
  final authRepository = ref.watch(authRepositoryProvider);
  return authRepository.authStateChanges;
}

// Proveedor para obtener y cachear los datos del usuario desde Firestore
// Depende de authStateChanges para actualizarse cuando el usuario inicia o cierra sesión.
@riverpod
Future<UserModel?> currentUserData(CurrentUserDataRef ref) async {
  // Esperamos a que el estado de autenticación se resuelva
  final authState = ref.watch(authStateChangesProvider);

  // Si no hay usuario autenticado (uid es null), retornamos null
  if (authState.valueOrNull == null) {
    return null;
  }

  // Si hay usuario autenticado, obtenemos sus datos de Firestore
  final authRepository = ref.watch(authRepositoryProvider);
  return await authRepository.getCurrentUserdata();
}

// Helpers para acceder fácilmente al rol y estado del usuario
final userRoleProvider = Provider<String?>((ref) {
  final user = ref.watch(currentUserDataProvider);
  // Usamos .when para manejar los estados de carga/error del FutureProvider
  return user.when(
    data: (userData) => userData?.role,
    loading: () => null,
    error: (_, __) => null,
  );
});

final isAuthenticatedProvider = Provider<bool>((ref) {
  final authState = ref.watch(authStateChangesProvider);
  return authState.valueOrNull != null;
});
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.g.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.g.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\providers\auth\auth_provider.g.dart
========================================
.
// GENERATED CODE - DO NOT MODIFY BY HAND

part of 'auth_provider.dart';

// **************************************************************************
// RiverpodGenerator
// **************************************************************************

String _$authStateChangesHash() => r'843eb1a621041def446e0ef856583a025a5a8e47';

/// See also [authStateChanges].
@ProviderFor(authStateChanges)
final authStateChangesProvider = AutoDisposeStreamProvider<User?>.internal(
  authStateChanges,
  name: r'authStateChangesProvider',
  debugGetCreateSourceHash: const bool.fromEnvironment('dart.vm.product')
      ? null
      : _$authStateChangesHash,
  dependencies: null,
  allTransitiveDependencies: null,
);

typedef AuthStateChangesRef = AutoDisposeStreamProviderRef<User?>;
String _$currentUserDataHash() => r'46c9c0509d112b80af043ad7a5382b6e04830dfc';

/// See also [currentUserData].
@ProviderFor(currentUserData)
final currentUserDataProvider = AutoDisposeFutureProvider<UserModel?>.internal(
  currentUserData,
  name: r'currentUserDataProvider',
  debugGetCreateSourceHash: const bool.fromEnvironment('dart.vm.product')
      ? null
      : _$currentUserDataHash,
  dependencies: null,
  allTransitiveDependencies: null,
);

typedef CurrentUserDataRef = AutoDisposeFutureProviderRef<UserModel?>;
// ignore_for_file: type=lint
// ignore_for_file: subtype_of_sealed_class, invalid_use_of_internal_member, invalid_use_of_visible_for_testing_member

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\auth_gate.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\auth_gate.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\auth_gate.dart
========================================
.
import 'package:flutter/foundation.dart'; // Importado para kDebugMode y debugPrint
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';
import 'package:power_gruas/presentation/screens/auth/login_screen.dart';
import 'package:power_gruas/presentation/screens/common/home_screen.dart';

// AuthGate decide qué pantalla mostrar al inicio de la aplicación.
class AuthGate extends ConsumerWidget {
  const AuthGate({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // Observamos el proveedor que verifica el estado de autenticación Y carga los datos del usuario.
    final userDataAsync = ref.watch(currentUserDataProvider);

    return userDataAsync.when(
      data: (userData) {
        // Si hay datos de usuario, vamos a Home
        if (userData != null) {
          return const HomeScreen();
        }
        // Si no hay datos, vamos a Login
        return const LoginScreen();
      },
      // Mientras carga, mostramos el Splash Screen
      loading: () => const SplashScreen(),
      error: (error, stackTrace) {
        // CORREGIDO: Evitar print en producción.
        if (kDebugMode) {
          debugPrint("Error en AuthGate: $error");
        }
        // Por seguridad, si falla la carga del perfil, lo enviamos a Login.
        return const LoginScreen();
      },
    );
  }
}

// Pantalla de Carga (Splash Screen)
class SplashScreen extends StatelessWidget {
  const SplashScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppConstants.primaryColor,
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Image.asset(
              AppConstants.logoLoading,
              width: 200,
            ),
            const SizedBox(height: 30),
            const CircularProgressIndicator(
              valueColor: AlwaysStoppedAnimation<Color>(Colors.white),
            ),
          ],
        ),
      ),
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\login_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\login_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\login_screen.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/presentation/providers/auth/auth_controller.dart';
import 'package:power_gruas/presentation/widgets/common/custom_button.dart';
import 'package:power_gruas/presentation/widgets/common/custom_text_field.dart';
import 'package:power_gruas/presentation/widgets/common/shake_widget.dart';

class LoginScreen extends ConsumerStatefulWidget {
  const LoginScreen({super.key});

  @override
  // CORREGIDO: Se usa ConsumerState<LoginScreen> para evitar 'library_private_types_in_public_api'
  ConsumerState<LoginScreen> createState() => _LoginScreenState();
}

class _LoginScreenState extends ConsumerState<LoginScreen> {
  final _formKey = GlobalKey<FormState>();
  final _emailController = TextEditingController();
  final _passwordController = TextEditingController();

  // Clave para el widget de Shake de la contraseña
  final _shakeKeyPassword = GlobalKey<ShakeWidgetState>();

  @override
  void dispose() {
    _emailController.dispose();
    _passwordController.dispose();
    super.dispose();
  }

  void _login() {
    if (_formKey.currentState!.validate()) {
      ref.read(authControllerProvider.notifier).signIn(
            _emailController.text.trim(),
            _passwordController.text.trim(),
          );
    }
  }

  @override
  Widget build(BuildContext context) {
    // Observamos el estado del AuthController para el indicador de carga
    final authState = ref.watch(authControllerProvider);

    // Listener para manejar errores y activar la animación
    ref.listen<AsyncValue>(authControllerProvider, (_, state) {
      if (state.hasError && !state.isLoading) {
        final error = state.error;

        // Mostramos el mensaje de error en un SnackBar
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(
            content: Text(error.toString()),
            backgroundColor: Colors.red,
          ),
        );

        // Si el error es una AuthException y es un error de credenciales, activamos el shake
        if (error is AuthException && error.isCredentialsError) {
          _shakeKeyPassword.currentState?.shake();
        }
      }
    });

    return Scaffold(
      body: Container(
        // Fondo degradado
        decoration: const BoxDecoration(
          gradient: LinearGradient(
            colors: [AppConstants.primaryColor, AppConstants.secondaryColor],
            begin: Alignment.topCenter,
            end: Alignment.bottomCenter,
          ),
        ),
        child: Center(
          child: SingleChildScrollView(
            padding: const EdgeInsets.all(24.0),
            child: Card(
              elevation: 8.0,
              // El shape se define en el tema global ahora.
              child: Padding(
                padding: const EdgeInsets.all(32.0),
                child: Form(
                  key: _formKey,
                  child: Column(
                    mainAxisSize: MainAxisSize.min,
                    children: [
                      Image.asset(
                        AppConstants.appIcon,
                        height: 150,
                      ),
                      const SizedBox(height: 30),
                      Text(
                        'Tu auxilio víal....',
                        style: Theme.of(context).textTheme.titleLarge?.copyWith(fontStyle: FontStyle.italic),
                      ),
                      const SizedBox(height: 30),

                      // Campo de Correo
                      CustomTextField(
                        controller: _emailController,
                        labelText: 'Correo Electrónico',
                        prefixIcon: Icons.email,
                        keyboardType: TextInputType.emailAddress,
                        validator: (value) => (value == null || value.isEmpty)
                            ? 'Ingresa tu correo'
                            : null,
                      ),
                      const SizedBox(height: 20),

                      // Campo de Contraseña envuelto en ShakeWidget
                      ShakeWidget(
                        key: _shakeKeyPassword,
                        child: CustomTextField(
                          controller: _passwordController,
                          labelText: 'Contraseña',
                          prefixIcon: Icons.lock,
                          obscureText: true,
                          validator: (value) => (value == null || value.isEmpty)
                              ? 'Ingresa tu contraseña'
                              : null,
                        ),
                      ),

                      // Botón de restablecimiento de contraseña
                      Align(
                        alignment: Alignment.centerRight,
                        child: TextButton(
                            onPressed: () => _showForgotPasswordDialog(context),
                            child: const Text('¿Contraseña olvidada? Haz clic aquí'),
                          ),
                      ),


                      const SizedBox(height: 15),

                      CustomButton(
                        text: 'Iniciar Sesión',
                        onPressed: _login,
                        isLoading: authState.isLoading,
                      ),
                      const SizedBox(height: 20),

                      TextButton(
                        onPressed: () => context.push('/register'),
                        child: const Text('¿No tienes cuenta? Regístrate aquí'),
                      ),
                    ],
                  ),
                ),
              ),
            ),
          ),
        ),
      ),
    );
  }

  // Diálogo para restablecer contraseña
  void _showForgotPasswordDialog(BuildContext context) {
    final TextEditingController resetEmailController = TextEditingController();
    final GlobalKey<FormState> resetFormKey = GlobalKey<FormState>();
    resetEmailController.text = _emailController.text.trim();

    // CORREGIDO: Guardamos el ScaffoldMessenger antes del showDialog para usarlo de forma segura después del await.
    final scaffoldMessenger = ScaffoldMessenger.of(context);

    showDialog(
      context: context,
      builder: (dialogContext) { // Usamos un contexto diferente para el diálogo
        return Consumer(
          builder: (consumerContext, ref, child) {
            final resetState = ref.watch(authControllerProvider);

            return AlertDialog(
              title: const Text('Restablecer Contraseña'),
              content: Form(
                key: resetFormKey,
                child: Column(
                  mainAxisSize: MainAxisSize.min,
                  children: [
                    const Text('Ingresa tu correo electrónico para recibir un enlace seguro de restablecimiento.'),
                    const SizedBox(height: 15),
                    CustomTextField(
                      controller: resetEmailController,
                      labelText: 'Correo Electrónico',
                      prefixIcon: Icons.email,
                      keyboardType: TextInputType.emailAddress,
                      validator: (value) => (value == null || !value.contains('@'))
                          ? 'Ingresa un correo válido'
                          : null,
                    ),
                  ],
                ),
              ),
              actions: [
                TextButton(
                  // Usamos el contexto del diálogo para cerrarlo
                  onPressed: resetState.isLoading ? null : () => Navigator.of(dialogContext).pop(),
                  child: const Text('Cancelar'),
                ),
                ElevatedButton(
                  onPressed: resetState.isLoading ? null : () async {
                    if (resetFormKey.currentState!.validate()) {
                      final email = resetEmailController.text.trim();

                      await ref.read(authControllerProvider.notifier).resetPassword(email);

                      // CORREGIDO: Verificamos si el contexto del diálogo sigue montado antes de usarlo.
                      if (!dialogContext.mounted) return;

                      final newState = ref.read(authControllerProvider);

                      if (!newState.hasError) {
                        Navigator.of(dialogContext).pop();
                        // Usamos el ScaffoldMessenger guardado
                        scaffoldMessenger.showSnackBar(
                          SnackBar(content: Text('Enlace de restablecimiento enviado a $email'), backgroundColor: Colors.green,),
                        );
                      }
                    }
                  },
                  child: resetState.isLoading ? const SizedBox(width: 20, height: 20, child: CircularProgressIndicator(strokeWidth: 2,)) : const Text('Enviar Enlace'),
                ),
              ],
            );
          },
        );
      },
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\register_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\register_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\auth\register_screen.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/presentation/providers/auth/auth_controller.dart';
import 'package:power_gruas/presentation/widgets/common/custom_button.dart';
import 'package:power_gruas/presentation/widgets/common/custom_text_field.dart';
import 'package:cloud_firestore/cloud_firestore.dart'; // Necesario para Timestamp

class RegisterScreen extends ConsumerStatefulWidget {
  const RegisterScreen({super.key});

  @override
  // CORREGIDO: Se usa ConsumerState<RegisterScreen> para evitar 'library_private_types_in_public_api'
  ConsumerState<RegisterScreen> createState() => _RegisterScreenState();
}

class _RegisterScreenState extends ConsumerState<RegisterScreen> {
  final _formKey = GlobalKey<FormState>();
  final _fullNameController = TextEditingController();
  final _cedulaController = TextEditingController();
  final _phoneController = TextEditingController();
  final _emailController = TextEditingController();
  final _passwordController = TextEditingController();
  final _confirmPasswordController = TextEditingController();

  @override
  void dispose() {
    _fullNameController.dispose();
    _cedulaController.dispose();
    _phoneController.dispose();
    _emailController.dispose();
    _passwordController.dispose();
    _confirmPasswordController.dispose();
    super.dispose();
  }

  void _register() {
    if (_formKey.currentState!.validate()) {
      if (_passwordController.text != _confirmPasswordController.text) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Las contraseñas no coinciden')),
        );
        return;
      }

      // Creamos el modelo de usuario inicial
      final newUser = UserModel(
        id: '', // Temporal
        fullName: _fullNameController.text.trim(),
        email: _emailController.text.trim(),
        phone: _phoneController.text.trim(),
        cedula: _cedulaController.text.trim(),
        role: AppConstants.roleCliente, // Rol por defecto
        createdAt: Timestamp.now(), // Temporal
      );

      ref.read(authControllerProvider.notifier).signUp(
            newUser,
            _passwordController.text.trim(),
          );
    }
  }

  @override
  Widget build(BuildContext context) {
    final authState = ref.watch(authControllerProvider);

     // Listener para errores
    ref.listen<AsyncValue>(authControllerProvider, (_, state) {
      if (state.hasError && !state.isLoading) {
        ScaffoldMessenger.of(context).showSnackBar(
          SnackBar(content: Text('Error en el registro: ${state.error.toString()}'), backgroundColor: Colors.red,),
        );
      }
      // La redirección exitosa la maneja el GoRouter
    });

    return Scaffold(
      appBar: AppBar(
        title: const Text('Crear Cuenta'),
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(24.0),
        child: Form(
          key: _formKey,
          child: Column(
            children: [
              Text(
                'Completa tus datos para empezar',
                style: Theme.of(context).textTheme.titleMedium,
              ),
              const SizedBox(height: 20),

              // Campos Obligatorios
              CustomTextField(
                controller: _fullNameController,
                labelText: 'Nombre y Apellido',
                prefixIcon: Icons.person,
                validator: (value) => (value == null || value.isEmpty) ? 'Campo obligatorio' : null,
              ),
              const SizedBox(height: 15),
              CustomTextField(
                controller: _cedulaController,
                labelText: 'Cédula de Identidad',
                prefixIcon: Icons.credit_card,
                validator: (value) => (value == null || value.isEmpty) ? 'Campo obligatorio' : null,
              ),
               const SizedBox(height: 15),
              CustomTextField(
                controller: _phoneController,
                labelText: 'Teléfono',
                prefixIcon: Icons.phone,
                keyboardType: TextInputType.phone,
                validator: (value) => (value == null || value.isEmpty) ? 'Campo obligatorio' : null,
              ),
               const SizedBox(height: 15),
              CustomTextField(
                controller: _emailController,
                labelText: 'Correo Electrónico',
                prefixIcon: Icons.email,
                keyboardType: TextInputType.emailAddress,
                validator: (value) => (value == null || !value.contains('@'))
                            ? 'Ingresa un correo válido'
                            : null,
              ),
               const SizedBox(height: 15),
              CustomTextField(
                controller: _passwordController,
                labelText: 'Contraseña',
                prefixIcon: Icons.lock,
                obscureText: true,
                validator: (value) => (value == null || value.length < 6)
                            ? 'Mínimo 6 caracteres'
                            : null,
              ),
               const SizedBox(height: 15),
               CustomTextField(
                controller: _confirmPasswordController,
                labelText: 'Confirmar Contraseña',
                prefixIcon: Icons.lock_outline,
                obscureText: true,
              ),

              const SizedBox(height: 30),

              CustomButton(
                text: 'Registrarse',
                onPressed: _register,
                isLoading: authState.isLoading,
              ),
               const SizedBox(height: 20),
                TextButton(
                  onPressed: () => context.pop(), // Vuelve a Login
                  child: const Text('¿Ya tienes cuenta? Inicia sesión'),
                ),
            ],
          ),
        ),
      ),
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\home_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\home_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\home_screen.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';
import 'package:power_gruas/presentation/widgets/common/app_drawer.dart';
import 'package:power_gruas/presentation/widgets/common/custom_app_bar.dart';

class HomeScreen extends ConsumerWidget {
  const HomeScreen({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final userAsync = ref.watch(currentUserDataProvider);

    return Scaffold(
      appBar: const CustomAppBar(title: 'PowerGrúas'),
      drawer: const AppDrawer(),
      body: Container(
        color: Theme.of(context).colorScheme.surface.withOpacity(0.1),
        child: Center(
          child: userAsync.when(
            data: (user) => Text(
              'Bienvenido, ${user?.fullName ?? 'Usuario'}',
              style: Theme.of(context).textTheme.headlineMedium,
            ),
            loading: () => const CircularProgressIndicator(),
            error: (err, stack) => const Text('Error al cargar datos'),
          ),
        ),
      ),
    );
  }
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\main_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\main_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\main_screen.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:power_gruas/presentation/screens/common/home_screen.dart';
import 'package:power_gruas/presentation/widgets/common/custom_app_bar.dart';

class MainScreen extends StatefulWidget {
  const MainScreen({super.key});

  @override
  State<MainScreen> createState() => _MainScreenState();
}

class _MainScreenState extends State<MainScreen> {
  int _selectedIndex = 0;

  // Lista de las vistas que se mostrarán.
  static const List<Widget> _widgetOptions = <Widget>[
    HomeScreen(),
    PlaceholderScreen(title: 'Solicitar Servicio'),
    PlaceholderScreen(title: 'Mis Servicios'),
    PlaceholderScreen(title: 'Perfil'),
  ];

  // Lista de títulos para el AppBar
  static const List<String> _widgetTitles = <String>[
    'PowerGrúas',
    'Solicitar Servicio',
    'Mis Servicios',
    'Mi Perfil',
  ];

  void _onItemTapped(int index) {
    setState(() {
      _selectedIndex = index;
    });
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: CustomAppBar(title: _widgetTitles[_selectedIndex]),
      body: Center(
        child: _widgetOptions.elementAt(_selectedIndex),
      ),
      bottomNavigationBar: BottomNavigationBar(
        items: const <BottomNavigationBarItem>[
          BottomNavigationBarItem(
            icon: Icon(Icons.home),
            label: 'Inicio',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.add_circle_outline),
            label: 'Solicitar',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.list_alt),
            label: 'Mis Servicios',
          ),
          BottomNavigationBarItem(
            icon: Icon(Icons.person_outline),
            label: 'Perfil',
          ),
        ],
        currentIndex: _selectedIndex,
        onTap: _onItemTapped,
        type: BottomNavigationBarType.fixed,
        backgroundColor: Colors.white,
        selectedItemColor: Theme.of(context).primaryColor,
        unselectedItemColor: Colors.grey[600],
      ),
    );
  }
}

// Widget de marcador de posición para las pantallas que aún no hemos creado
class PlaceholderScreen extends StatelessWidget {
  final String title;
  const PlaceholderScreen({super.key, required this.title});

  @override
  Widget build(BuildContext context) {
    // El AppBar ahora se maneja en MainScreen, por lo que este widget
    // solo necesita mostrar el contenido central.
    return Center(
      child: Text(
        title,
        style: Theme.of(context).textTheme.headlineMedium,
      ),
    );
  }
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\profile_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\profile_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\common\profile_screen.dart
========================================
.
import 'package:cached_network_image/cached_network_image.dart';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/presentation/providers/auth/auth_controller.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';

class ProfileScreen extends ConsumerWidget {
  const ProfileScreen({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final userAsync = ref.watch(currentUserDataProvider);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Mi Perfil'),
        actions: [
          IconButton(
            icon: const Icon(Icons.edit),
            onPressed: () {
              // TODO: Navegar a la pantalla de edición de perfil
               ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Navegar a Editar Perfil')));
            },
          ),
        ],
      ),
      body: userAsync.when(
        data: (user) => user != null ? _buildProfileView(context, ref, user) : const Center(child: Text('Usuario no encontrado')),
        loading: () => const Center(child: CircularProgressIndicator()),
        error: (error, stack) => Center(child: Text('Error: $error')),
      ),
    );
  }

  Widget _buildProfileView(BuildContext context, WidgetRef ref, UserModel user) {
    return SingleChildScrollView(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        children: [
          // Foto de Perfil
          _buildProfilePicture(context, user),
          const SizedBox(height: 16),
          Text(user.fullName, style: Theme.of(context).textTheme.titleLarge),
          Text(user.email, style: Theme.of(context).textTheme.bodyMedium),
          const SizedBox(height: 8),
          Chip(
            label: Text(user.role.toUpperCase()),
            backgroundColor: _getRoleColor(user.role),
            labelStyle: const TextStyle(color: Colors.white),
          ),
           if (user.codigoEmpleado != null)
            Padding(
              padding: const EdgeInsets.only(top: 8.0),
              child: Text('Código Empleado: ${user.codigoEmpleado}', style: Theme.of(context).textTheme.bodySmall),
            ),

          const Divider(height: 40),

          // Información de Contacto
          _buildInfoTile(Icons.phone, 'Teléfono', user.phone),
          _buildInfoTile(Icons.credit_card, 'Cédula', user.cedula),

          const Divider(height: 40),

          // Gestión de Vehículos (Solo si no es Aseguradora)
          if (user.role != AppConstants.roleAseguradora)
            ListTile(
              leading: const Icon(Icons.directions_car, color: AppConstants.primaryColor),
              title: const Text('Gestionar Vehículos'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () {
                // TODO: Navegar a la pantalla de gestión de vehículos
                 ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Navegar a Gestionar Vehículos')));
              },
            ),

          // Contáctanos y Acerca de Nosotros (Como se definió en los requerimientos)
           ListTile(
              leading: const Icon(Icons.info_outline, color: AppConstants.primaryColor),
              title: const Text('Acerca de Nosotros'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () {
                // TODO: Navegar a Acerca de Nosotros
                 ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Navegar a Acerca de Nosotros')));
              },
            ),
             ListTile(
              leading: const Icon(Icons.contact_support, color: AppConstants.primaryColor),
              title: const Text('Contáctanos'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () {
                // TODO: Navegar a Contáctanos
                 ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Navegar a Contáctanos')));
              },
            ),


          const Divider(height: 40),

          // Cerrar Sesión
          ListTile(
            leading: const Icon(Icons.logout, color: Colors.red),
            title: const Text('Cerrar Sesión', style: TextStyle(color: Colors.red)),
            onTap: () => _confirmSignOut(context, ref),
          ),
        ],
      ),
    );
  }

  Widget _buildProfilePicture(BuildContext context, UserModel user) {
    return Stack(
      children: [
        CircleAvatar(
          radius: 60,
          backgroundColor: AppConstants.primaryColor.withOpacity(0.1),
          child: user.photoUrl != null
              ? ClipOval(
                  child: CachedNetworkImage(
                    imageUrl: user.photoUrl!,
                    fit: BoxFit.cover,
                    width: 120,
                    height: 120,
                    placeholder: (context, url) => const CircularProgressIndicator(),
                    errorWidget: (context, url, error) => const Icon(Icons.person, size: 60),
                  ),
                )
              : const Icon(Icons.person, size: 60, color: AppConstants.primaryColor),
        ),
        Positioned(
          bottom: 0,
          right: 0,
          child: Container(
            decoration: const BoxDecoration(
              color: AppConstants.secondaryColor,
              shape: BoxShape.circle,
            ),
            child: IconButton(
              icon: const Icon(Icons.camera_alt, color: Colors.white, size: 20,),
              onPressed: () {
                // TODO: Lógica para subir/cambiar foto de perfil (ImagePicker y UserRepository)
                 ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Implementar Carga de Foto')));
              },
            ),
          ),
        ),
      ],
    );
  }

  Widget _buildInfoTile(IconData icon, String title, String subtitle) {
    return ListTile(
      leading: Icon(icon, color: AppConstants.primaryColor),
      title: Text(title),
      subtitle: Text(subtitle),
    );
  }

  Color _getRoleColor(String role) {
    switch (role) {
      case AppConstants.roleAdmin:
        return Colors.red;
      case AppConstants.roleOperador:
        return Colors.orange;
      case AppConstants.roleGruero:
        return Colors.blue;
      case AppConstants.roleAseguradora:
        return Colors.purple;
      default:
        return Colors.grey;
    }
  }

  void _confirmSignOut(BuildContext context, WidgetRef ref) {
    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Confirmar Cierre de Sesión'),
        content: const Text('¿Estás seguro de que deseas cerrar sesión?'),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Cancelar'),
          ),
          TextButton(
            onPressed: () {
              Navigator.pop(context);
              // Llamamos al AuthController para cerrar sesión
              ref.read(authControllerProvider.notifier).signOut();
            },
            child: const Text('Cerrar Sesión', style: TextStyle(color: Colors.red)),
          ),
        ],
      ),
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\my_services_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\my_services_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\my_services_screen.dart
========================================
.
import 'package:flutter/material.dart';

class MyServicesScreen extends StatelessWidget {
  const MyServicesScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Mis Servicios'),
      ),
      body: const Center(
        child: Text(
          'Pantalla de Mis Servicios',
          style: TextStyle(fontSize: 24),
        ),
      ),
    );
  }
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\request_service_screen.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\request_service_screen.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\screens\services\request_service_screen.dart
========================================
.
import 'package:flutter/material.dart';

class RequestServiceScreen extends StatelessWidget {
  const RequestServiceScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Solicitar Servicio'),
      ),
      body: const Center(
        child: Text(
          'Pantalla de Solicitud de Servicio',
          style: TextStyle(fontSize: 24),
        ),
      ),
    );
  }
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\cards\menu_card.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\cards\menu_card.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\cards\menu_card.dart
========================================
.
import 'package:flutter/material.dart';
import 'package:power_gruas/config/constants/app_constants.dart';

class MenuCard extends StatefulWidget {
  final String title;
  final IconData icon;
  final VoidCallback onTap;
  final Color color;

  const MenuCard({
    super.key,
    required this.title,
    required this.icon,
    required this.onTap,
    required this.color,
  });

  @override
  State<MenuCard> createState() => _MenuCardState();
}

class _MenuCardState extends State<MenuCard> {
  bool _isPressed = false;

  void _onTapDown(TapDownDetails details) {
    setState(() {
      _isPressed = true;
    });
  }

  void _onTapUp(TapUpDetails details) {
    Future.delayed(const Duration(milliseconds: 100), () {
      if (mounted) {
        widget.onTap();
        setState(() {
          _isPressed = false;
        });
      }
    });
  }

  void _onTapCancel() {
    setState(() {
      _isPressed = false;
    });
  }

  @override
  Widget build(BuildContext context) {
    final scale = _isPressed ? 0.95 : 1.0;

    return GestureDetector(
      onTapDown: _onTapDown,
      onTapUp: _onTapUp,
      onTapCancel: _onTapCancel,
      child: AnimatedContainer(
        duration: const Duration(milliseconds: 150),
        transform: Matrix4.identity()..scale(scale),
        transformAlignment: Alignment.center,
        decoration: BoxDecoration(
          color: Colors.white,
          borderRadius: BorderRadius.circular(15.0),
          boxShadow: [
            BoxShadow(
              color: Colors.black.withOpacity(0.1),
              blurRadius: 20,
              offset: const Offset(0, 10),
            ),
          ],
        ),
        child: Padding(
          padding: const EdgeInsets.all(20),
          child: SingleChildScrollView(
            physics: const BouncingScrollPhysics(),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.center,
              children: [
                CircleAvatar(
                  radius: 28,
                  backgroundColor: widget.color,
                  child: Icon(widget.icon, size: 28, color: Colors.white),
                ),
                const SizedBox(height: 15),
                Text(
                  widget.title,
                  style: Theme.of(context).textTheme.titleMedium?.copyWith(
                        color: AppConstants.textColor,
                        fontWeight: FontWeight.bold,
                      ),
                  textAlign: TextAlign.center,
                ),
              ],
            ),
          ),
        ),
      ),
    );
  }
}

C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\app_drawer.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\app_drawer.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\app_drawer.dart
========================================
.
import 'package:cached_network_image/cached_network_image.dart';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/presentation/providers/auth/auth_controller.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';

class AppDrawer extends ConsumerWidget {
  const AppDrawer({super.key});

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final user = ref.watch(currentUserDataProvider).value;
    final userRole = ref.watch(userRoleProvider);

    return Drawer(
      child: ListView(
        padding: EdgeInsets.zero,
        children: <Widget>[
          UserAccountsDrawerHeader(
            accountName: Text(user?.fullName ?? 'Usuario'),
            accountEmail: Text(user?.email ?? ''),
            currentAccountPicture: CircleAvatar(
              backgroundColor: Colors.white,
              child: user?.photoUrl != null
                  ? ClipOval(
                      child: CachedNetworkImage(
                        imageUrl: user!.photoUrl!,
                        fit: BoxFit.cover,
                        width: 90,
                        height: 90,
                        placeholder: (context, url) => const Icon(Icons.person, color: Colors.grey),
                        errorWidget: (context, url, error) => const Icon(Icons.error, color: Colors.red),
                      ),
                    )
                  : const Icon(Icons.person, color: Colors.grey),
            ),
            decoration: BoxDecoration(
              color: Theme.of(context).primaryColor,
            ),
          ),
          
          if (userRole != null) ..._buildMenuItems(context, userRole),

          const Divider(),
          ListTile(
            leading: const Icon(Icons.logout),
            title: const Text('Cerrar Sesión'),
            onTap: () {
              ref.read(authControllerProvider.notifier).signOut();
              Navigator.of(context).pop();
            },
          ),
        ],
      ),
    );
  }

  List<Widget> _buildMenuItems(BuildContext context, String role) {
    List<Widget> items = [];

    // --- Items Comunes ---
    if ([AppConstants.roleCliente, AppConstants.roleGruero, AppConstants.roleOperador, AppConstants.roleAdmin].contains(role)) {
      items.add(ListTile(leading: const Icon(Icons.car_repair), title: const Text('Solicitar Servicio'), onTap: () => _navigateTo(context, '/request_service')));
      items.add(ListTile(leading: const Icon(Icons.history), title: const Text('Mis Servicios'), onTap: () => _navigateTo(context, '/my_services')));
    }

    // --- Items de Gruero ---
    if (role == AppConstants.roleGruero) {
      items.add(ListTile(leading: const Icon(Icons.assignment_turned_in), title: const Text('Servicios Asignados'), onTap: () => _navigateTo(context, '/assigned_services')));
    }

    // --- Items de Aseguradora ---
    if (role == AppConstants.roleAseguradora) {
      items.add(ListTile(leading: const Icon(Icons.shield), title: const Text('Solicitud para Asegurados'), onTap: () => _navigateTo(context, '/insured_request')));
      items.add(ListTile(leading: const Icon(Icons.list_alt), title: const Text('Mis Solicitudes'), onTap: () => _navigateTo(context, '/my_requests')));
    }

    // --- Items de Administración ---
    if ([AppConstants.roleOperador, AppConstants.roleAdmin].contains(role)) {
      items.add(ListTile(leading: const Icon(Icons.dashboard), title: const Text('Panel de Solicitudes'), onTap: () => _navigateTo(context, '/admin/request_panel')));
      items.add(ListTile(leading: const Icon(Icons.people), title: const Text('Gestión de Personal'), onTap: () => _navigateTo(context, '/admin/personnel')));
      items.add(ListTile(leading: const Icon(Icons.local_shipping), title: const Text('Gestión de Flota'), onTap: () => _navigateTo(context, '/admin/fleet')));
    }

    // --- Item de Admin ---
    if (role == AppConstants.roleAdmin) {
      items.add(ListTile(leading: const Icon(Icons.attach_money), title: const Text('Tarifas y Servicios'), onTap: () => _navigateTo(context, '/admin/rates')));
    }
    
    // --- Perfil (siempre disponible) ---
    items.add(ListTile(leading: const Icon(Icons.person_outline), title: const Text('Mi Perfil'), onTap: () => _navigateTo(context, '/profile')));

    return items;
  }

  void _navigateTo(BuildContext context, String path) {
    Navigator.of(context).pop();
    context.push(path);
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_app_bar.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_app_bar.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_app_bar.dart
========================================
.
import 'package:cached_network_image/cached_network_image.dart';
import 'package:flutter/material.dart';
import 'package:flutter_riverpod/flutter_riverpod.dart';
import 'package:go_router/go_router.dart';
import 'package:power_gruas/config/constants/app_constants.dart';
import 'package:power_gruas/data/models/user_model.dart';
import 'package:power_gruas/presentation/providers/auth/auth_provider.dart';

class CustomAppBar extends ConsumerWidget implements PreferredSizeWidget {
  final String title;
  final List<Widget>? actions;

  const CustomAppBar({
    // CORREGIDO: Usar super.key
    super.key,
    required this.title,
    this.actions
  });

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    // Leemos el valor directamente. MainLayoutScreen se encarga del estado de carga/error.
    final user = ref.watch(currentUserDataProvider).value;

    return AppBar(
      title: Text(title),
      actions: [
        ...?actions,
        // Construimos el avatar directamente, ya que 'user' está garantizado.
        _buildUserAvatar(context, user),
      ],
    );
  }

  Widget _buildUserAvatar(BuildContext context, UserModel? user) {
    if (user == null) return const SizedBox.shrink();

    return Padding(
      padding: const EdgeInsets.only(right: 16.0),
      child: GestureDetector(
        // Al pulsar el avatar, vamos al perfil
        onTap: () => context.push('/profile'),
        child: CircleAvatar(
          radius: 22, // Borde
          backgroundColor: AppConstants.secondaryColor,
          child: CircleAvatar(
            radius: 20, // Avatar interior
            backgroundColor: Colors.white,
            child: user.photoUrl != null
                ? ClipOval(
                    child: CachedNetworkImage(
                      imageUrl: user.photoUrl!,
                      fit: BoxFit.cover,
                      width: 40,
                      height: 40,
                      placeholder: (context, url) =>
                          const Icon(Icons.person, color: Colors.grey),
                      errorWidget: (context, url, error) =>
                          const Icon(Icons.error, color: Colors.red),
                    ),
                  )
                : const Icon(Icons.person, color: Colors.grey, size: 30),
          ),
        ),
      ),
    );
  }

  @override
  Size get preferredSize => const Size.fromHeight(kToolbarHeight);
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_button.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_button.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_button.dart
========================================
.
import 'package:flutter/material.dart';

class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback onPressed;
  final bool isLoading;

  const CustomButton({
    // CORREGIDO: Usar super.key
    super.key,
    required this.text,
    required this.onPressed,
    this.isLoading = false,
  });

  @override
  Widget build(BuildContext context) {
    return SizedBox(
      width: double.infinity,
      child: ElevatedButton(
        // Deshabilitamos el botón si está cargando
        onPressed: isLoading ? null : onPressed,
        child: isLoading
            ? const SizedBox(
                height: 24,
                width: 24,
                child: CircularProgressIndicator(
                  strokeWidth: 2,
                  // El color lo maneja el tema del botón
                ),
              )
            : Text(text),
      ),
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_text_field.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_text_field.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\custom_text_field.dart
========================================
.
import 'package:flutter/material.dart';

class CustomTextField extends StatelessWidget {
  final TextEditingController controller;
  final String labelText;
  final IconData prefixIcon;
  final bool obscureText;
  final TextInputType keyboardType;
  final String? Function(String?)? validator;

  const CustomTextField({
    // CORREGIDO: Usar super.key
    super.key,
    required this.controller,
    required this.labelText,
    required this.prefixIcon,
    this.obscureText = false,
    this.keyboardType = TextInputType.text,
    this.validator,
  });

  @override
  Widget build(BuildContext context) {
    return TextFormField(
      controller: controller,
      obscureText: obscureText,
      keyboardType: keyboardType,
      decoration: InputDecoration(
        labelText: labelText,
        prefixIcon: Icon(prefixIcon),
        // El resto del estilo se define globalmente en app_theme.dart
      ),
      validator: validator,
    );
  }
}
C:\Users\Jhan-PC\power_gruas>(
echo..  
 echo ========================================  
 echo --- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\shake_widget.dart  
 echo ========================================  
 echo..  
 type "C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\shake_widget.dart" 
) 
.
========================================
--- Archivo: C:\Users\Jhan-PC\power_gruas\lib\presentation\widgets\common\shake_widget.dart
========================================
.
import 'package:flutter/material.dart';
import 'dart:math' as math;

// Widget que permite animar a su hijo con un efecto de "temblor" (shake).
class ShakeWidget extends StatefulWidget {
  final Widget child;
  final Duration duration;
  final double deltaX;
  final Curve curve;
  // Usamos un GlobalKey para poder llamar al método shake() desde fuera (ej. desde LoginScreen)
  // ignore: prefer_const_constructors_in_immutables
  ShakeWidget({
    required Key key,
    required this.child,
    this.duration = const Duration(milliseconds: 500),
    this.deltaX = 8.0, // Magnitud del temblor (leve)
    this.curve = Curves.elasticOut,
  }) : super(key: key);

  @override
  ShakeWidgetState createState() => ShakeWidgetState();
}

class ShakeWidgetState extends State<ShakeWidget>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: widget.duration,
      vsync: this,
    );
  }

  // Método público para activar la animación
  void shake() {
    // Verificamos que el widget siga montado antes de intentar animar
    if (mounted) {
       _controller.reset();
       _controller.forward();
    }
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }

  // Función que define el desplazamiento sinusoidal para el temblor
  double _shake(double animation) {
    // f(x) = A * sin(x * pi * N)
    // A es la amplitud (deltaX). N define el número de oscilaciones (4 para un temblor rápido).
    return widget.deltaX * math.sin(animation * math.pi * 4);
  }

  @override
  Widget build(BuildContext context) {
    return AnimatedBuilder(
      animation: _controller,
      builder: (context, child) {
        // Usamos una curva para suavizar el movimiento
        final animation = CurvedAnimation(parent: _controller, curve: widget.curve);
        return Transform.translate(
          offset: Offset(_shake(animation.value), 0),
          child: child,
        );
      },
      child: widget.child,
    );
  }
}